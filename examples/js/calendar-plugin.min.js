!function(st){var ot={ACTIVE:"active",LOADER_SHOW:"show-loader",CONTAINER:"cp-container",CALENDAR:"cp-calendar",MONTH_CALENDAR:"cp-calendar-{month}",SEASON_CALENDAR:"cp-calendar-{season}",HEADER:"cp-header",HEADER_CONTENT:"cp-header-content",HEADER_OPTIONS_CONTAINER:"cp-header-options-container",HEADER_OPTIONS:"cp-header-options",HEADER_OPTIONS_INNER:"cp-header-options-inner",HEADER_OPTIONS_BUTTONS_CONTAINER:"cp-header-options-buttons-container",HEADER_OPTIONS_BUTTON:"cp-header-options-button",HEADER_OPTIONS_ABOVE:"cp-header-options-above",HEADER_OPTIONS_VISIBLE:"cp-header-options-visible",NAV_CONTROLS:"cp-nav-controls",CONTROLS_CONTAINER:"cp-nav",MONTH_HEADER:"cp-header-{month}",SEASON_HEADER:"cp-header-{season}",DATE_CELL:"cp-date",DATE_DAY:"cp-day",DATE_SELECTED:"cp-date-selected",DATE_CELL_CONTENT:"cp-date-content",WEEK_ROW:"cp-week",WEEK_EVENTS:"cp-week-events",MONTH_HEADING:"cp-month-heading",MONTH_CELL:"cp-month",MONTH_NAME_BUTTON:"cp-month-name",EMPTY_DAY:"cp-empty-day",EMPTY_DAY_BEGINNING:"cp-empty-day-beginning",EMPTY_DAY_ENDING:"cp-empty-day-ending",ADD_MENU_CONTAINER:"cp-add-menu",ADD_MENU_INNER:"cp-add-menu-inner",ADD_MENU_BUTTONS_CONTAINER:"cp-add-menu-buttons-container",ADD_MENU_BUTTON:"cp-add-menu-button",ADD_MENU_ABOVE:"cp-add-menu-above",ADD_MENU_VISIBLE:"cp-add-menu-visible",VIEWS_LIST_CONTAINER:"cp-view-list-container",VIEWS_LIST:"cp-view-list",VIEWS_ITEM:"cp-view",VIEW_BUTTON:"cp-view-button",EVENTS_CONTAINER_READY:"ready"},lt={BODY:"body",CONTAINER:".cp-container",CONTAINER_ID:"cp-container-id",CALENDAR:".cp-calendar",HEADER:".cp-header",HEADER_CONTENT:".cp-header-content",HEADER_OPTIONS_CONTAINER:".cp-header-options-container",HEADER_OPTIONS:".cp-header-options",HEADER_OPTIONS_INNER:".cp-header-options-inner",HEADER_OPTIONS_BUTTONS_CONTAINER:".cp-header-options-buttons-container",HEADER_OPTIONS_BUTTON:".cp-header-options-button",HEADER_OPTIONS_ABOVE:".cp-header-options-above",HEADER_OPTIONS_VISIBLE:".cp-header-options-visible",NAV_CONTROLS:".cp-nav-controls",CONTROL_BUTTONS:"button.cp-nav",DATE_CELL:".cp-date",DATE_DAY:".cp-day",DATE_SELECTED:".cp-date-selected",DATE_CELL_CONTENT:".cp-date-content",WEEK_ROW:".cp-week",WEEK_EVENTS:".cp-week-events",MONTH_HEADING:".cp-month-heading",MONTH_CELL:".cp-month",MONTH_NAME_BUTTON:".cp-month-name",EMPTY_DAY:".cp-empty-day",EMPTY_DAY_BEGINNING:".cp-empty-day-beginning",EMPTY_DAY_ENDING:".cp-empty-day-ending",ADD_MENU_CONTAINER:".cp-add-menu",ADD_MENU_INNER:".cp-add-menu-inner",ADD_MENU_BUTTON:".cp-add-menu-button",ADD_MENU_BUTTONS_CONTAINER:".cp-add-menu-buttons-container",VIEWS_LIST_CONTAINER:".cp-view-list-container",VIEWS_LIST:".cp-view-list",VIEWS_ITEM:".cp-view",VIEW_BUTTON:".cp-view-button",VIEW_SELECTOR:'[data-toggle="calendar-view"]',EVENT_FORM_MODAL:".cp-ef-modal",EXPORT_BUTTON:'[data-export="calendar"]'},dt={CONTAINER:"<div class='"+ot.CONTAINER+"' id='"+lt.CONTAINER_ID+"'>{header}{calendar}{event-containers}{add_menu}</div>",MAIN:"<table class='"+ot.CALENDAR+" {classnames}'  cellspacing='0' cellpadding='0'><thead>{heading}</thead><tbody>{content}</tbody></table>",DAYS_HEADING:"<tr class='"+ot.MONTH_HEADING+"'> <th>Sun</th> <th>Mon</th> <th>Tue</th> <th>Wed</th> <th>Thur</th> <th>Fri</th> <th>Sat</th> </tr>",WEEK_ROW:"<tr class='"+ot.WEEK_ROW+"' data-row='{row}'>{content}</tr>",DAY_CELL:"<td class='"+ot.DATE_CELL+" {classnames}' data-date='{date}'><div class='"+ot.DATE_CELL_CONTENT+"'>{content}</div></td>",HEADER:"<div class='"+ot.HEADER+" {classnames}'><div class='"+ot.NAV_CONTROLS+"'>{left-control}{right-control}</div><div class='"+ot.HEADER_CONTENT+"'><div class='"+ot.HEADER_OPTIONS_CONTAINER+"'><button class='"+ot.MONTH_NAME_BUTTON+"'>{month}<span class='caret'></span></button><div class='"+ot.HEADER_OPTIONS+"' id='headerOptionsComponent'><div class='"+ot.HEADER_OPTIONS_INNER+"'><div class='"+ot.HEADER_OPTIONS_BUTTONS_CONTAINER+"'><a class='"+ot.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='pdf'>Export to .pdf</a><a class='"+ot.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='docx'>Export to .docx</a></div><span class='caret'></span></div></div></div></div>{view-options}</div>",VIEWS:"<div class='"+ot.VIEWS_LIST_CONTAINER+"'><ul class='"+ot.VIEWS_LIST+"'><li class='"+ot.VIEWS_ITEM+"'><button type='button' class='"+ot.VIEW_BUTTON+" daily' data-toggle='calendar-view' data-option='daily'>Daily</button></li><li class='"+ot.VIEWS_ITEM+"'><button type='button' class='"+ot.VIEW_BUTTON+" weekly' data-toggle='calendar-view' data-option='weekly'>Weekly</button></li><li class='"+ot.VIEWS_ITEM+"'><button type='button' class='"+ot.VIEW_BUTTON+" monthly' data-toggle='calendar-view' data-option='monthly'>Monthly</button></li></ul></div>",CONTROL:"<button class='"+ot.CONTROLS_CONTAINER+"' type='submit' {direction}>{label}</button>",ADD_MENU:"<div class='"+ot.ADD_MENU_CONTAINER+"' id='addMenuComponent'><div class='"+ot.ADD_MENU_INNER+"'><div class='"+ot.ADD_MENU_BUTTONS_CONTAINER+"'><button class='"+ot.ADD_MENU_BUTTON+"' type='button' data-action='add-event'>Add Event</button><button class='"+ot.ADD_MENU_BUTTON+" cancel' data-action='cancel' type='button'>Cancel</button></div><span class='caret'></span></div></div>",EVENTS_CONTAINER:"<div class='"+ot.WEEK_EVENTS+"' data-row='{row}'></div>"},rt={spring:{display_name:"Spring",months:[3,4,5,6]},summer:{display_name:"Summer",months:[7,8,9]},fall:{display_name:"Fall",months:[10,11]},winter:{display_name:"Winter",months:[12,1,2]}},ct=["January","February","March","April","May","June","July","August","September","October","November","December"],t=new function(){var A=this;A.now=new Date,A.selection=[],A.modal=null,A.editModal=null,A.events=[],A.eventInstances=[],A.viewOptions=["daily","weekly","monthly"];var l=moment(),d=moment(l).add(6,"days"),a=moment();A.settings={},A.init=function(t){A.el=this,A.settings=st.extend({month:A.now.getMonth()+1,year:A.now.getFullYear(),dayStyle:"short",cellMaxHeigh:200,respData:"data",id:"id",title:"title",startDate:"startDate",endDate:"endDate",startTime:"startTime",endTime:"endTime",creatRequest:null,editRequest:null,view:"monthly",hideViewOptions:!1},t);var e=st.extend(rt,t?t.seasons:{});return A.settings.seasons=e,(A.settings.month<1||12<A.settings.month)&&(A.settings.month=1),n(),A};var n=function(){t(),A.modal=new CPEventFormModal("new-event"+A.now.getTime(),{url:A.settings.createUrl||A.settings.url||null,data:A.settings.data,headers:A.settings.headers,onSaved:K,requestStruct:A.settings.creatRequest||null}),A.modal.render(),A.editModal=new CPEventFormModal("edit-event"+A.now.getTime(),{editting:!0,url:A.settings.editUrl||A.settings.url||null,deleteUrl:A.settings.deleteUrl||A.settings.url||null,data:A.settings.data,headers:A.settings.headers,onSaved:K,onDelete:K,requestStruct:A.settings.editRequest||null}),A.editModal.render()},t=function(){var t="";switch(A.settings.view){case"daily":t=s();break;case"weekly":t=e();break;case"monthly":t=_(N())}0<st(A.el).find(lt.CONTAINER).length?st(A.el).find(lt.CONTAINER).fadeOut(1,function(){st(A.el).html(""),st(t).hide().prependTo(st(A.el)).fadeIn(1,function(){K()}).call(v)}):st(t).hide().prependTo(st(A.el)).fadeIn(1,function(){K()}).call(v)},e=function(){return"<div class='"+ot.CONTAINER+"' id='"+lt.CONTAINER_ID+"'>"+D("weekly")+"<table class='"+ot.CALENDAR+" {classnames} weekly'  cellspacing='0' cellpadding='0'><thead>"+c()+"</thead><tbody>"+h()+"</tbody></table>"+O()+"</div>"},s=function(){return"<div class='"+ot.CONTAINER+"' id='"+lt.CONTAINER_ID+"'>"+D("daily")+"<table class='"+ot.CALENDAR+" {classnames} weekly'  cellspacing='0' cellpadding='0'><thead>"+o()+"</thead><tbody>"+r()+"</tbody></table>"+O()+"</div>"},o=function(){return'<tr class="'+ot.MONTH_HEADING+'"><th col-span="0" style="width: initial; text-align: right;">Time</th><th col-span="10" style="width: initial; text-align: center;">&nbsp;</th></tr>'},r=function(){for(var t,e=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],n="",i=0;i<e.length;i++)t=12<i?"PM":"AM",n+='<tr class="'+ot.WEEK_ROW+' daily">\n                            <td col-span="0" style="width: initial; text-align: right; padding-right: 15px;">'+at(e[i])+" "+t+'</td>\n                            <td col-span="10" style="width: initial;" class="'+ot.DATE_CELL+" "+ot.DATE_DAY+'" data-date="'+a.get("time")+'">\n                                <div class="'+ot.DATE_CELL_CONTENT+'">&nbsp;</div>\n                            </td>\n                        </tr>';return n},c=function(){for(var t='<tr class="'+ot.MONTH_HEADING+'"><th style=" text-align: right;">Time</th>',e=l.get("time");e<=d.get("time");e+=864e5)t+='<th style="text-align: center;">'+moment(e).format("ddd DD")+"</th>";return t+="</tr>"},h=function(){for(var t,e,n,i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],a="",s=0;s<i.length;s++){n=12<s?"PM":"AM",t=at(i[s])+" "+n,a+='<tr class="'+ot.WEEK_ROW+' weekly"><td style=" text-align: right; padding-right: 15px;">'+t+"</td>";for(var o=l.get("time");o<=d.get("time");o+=864e5)e=moment(moment(o).format("YYYY-MM-DD ")+at(i[s])+":00:00"),a+='<td class="'+ot.DATE_CELL+" "+ot.DATE_DAY+'" data-date="'+e.get("time")+'"><div class="'+ot.DATE_CELL_CONTENT+'">&nbsp;</div></td>';a+="</tr>"}return a},D=function(t){var e=X(A.settings.month-1),n="";if(n+=" "+ot.MONTH_HEADER.replace("{month}",X(A.settings.month-1).toLowerCase())+" ",n+=" "+ot.SEASON_HEADER.replace("{season}",G()?G().name:"")+" ","weekly"==t){e=X(l.get("month"));n+=" "+ot.MONTH_HEADER.replace("{month}",X(l.get("month")-1).toLowerCase())+" ",e+=" "+at(l.get("date"))+" - ",e+=d.get("month")!=l.get("month")?X(d.get("month"))+" "+at(d.get("date")):at(d.get("date"))}if("daily"==t){e=a.format("Do MMMM YYYY");n+=" "+ot.MONTH_HEADER.replace("{month}",X(a.get("month")-1).toLowerCase())+" "}return"<div class='"+ot.HEADER+" "+n+"'><div class='"+ot.NAV_CONTROLS+"'>"+E("left")+E("right")+"</div><div class='"+ot.HEADER_CONTENT+"'><div class='"+ot.HEADER_OPTIONS_CONTAINER+"'><button class='"+ot.MONTH_NAME_BUTTON+"'>"+e+"<span class='caret'></span></button><div class='"+ot.HEADER_OPTIONS+"' id='headerOptionsComponent'><div class='"+ot.HEADER_OPTIONS_INNER+"'><div class='"+ot.HEADER_OPTIONS_BUTTONS_CONTAINER+"'><a class='"+ot.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='pdf'>Export to .pdf</a><a class='"+ot.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='docx'>Export to .docx</a></div><span class='caret'></span></div></div></div></div>"+u()+"</div>"},E=function(t){var e="right"==t?"&rarr;":"&larr;";return"<button class='"+ot.CONTROLS_CONTAINER+"' type='submit' "+t+">"+e+"</button>"},u=function(){return"<div class='"+ot.VIEWS_LIST_CONTAINER+"'><ul class='"+ot.VIEWS_LIST+"'><li class='"+ot.VIEWS_ITEM+"'><button type='button' class='"+ot.VIEW_BUTTON+" daily' data-toggle='calendar-view' data-option='daily'>Day</button></li><li class='"+ot.VIEWS_ITEM+"'><button type='button' class='"+ot.VIEW_BUTTON+" weekly' data-toggle='calendar-view' data-option='weekly'>Week</button></li><li class='"+ot.VIEWS_ITEM+"'><button type='button' class='"+ot.VIEW_BUTTON+" monthly' data-toggle='calendar-view' data-option='monthly'>Month</button></li></ul></div>"},O=function(){return"<div class='"+ot.ADD_MENU_CONTAINER+"' id='addMenuComponent'><div class='"+ot.ADD_MENU_INNER+"'><div class='"+ot.ADD_MENU_BUTTONS_CONTAINER+"'><button class='"+ot.ADD_MENU_BUTTON+"' type='button' data-action='add-event'>Add Event</button><button class='"+ot.ADD_MENU_BUTTON+" cancel' data-action='cancel' type='button'>Cancel</button></div><span class='caret'></span></div></div>"},T=function(){for(var t=0;t<A.eventInstances.length;t++){A.eventInstances[t].destroy()}A.eventInstances=[]},v=function(){var t=lt.CONTAINER,e=lt.ADD_MENU_BUTTON,n=lt.EXPORT_BUTTON;p(),st(window).off("resize",p),st(window).on("resize",p),I(),st(window).off("resize",I),st(window).on("resize",I),st(window).off("resize",x),st(window).on("resize",x),st(t).find(e).off("click",M),st(t).find(e).on("click",M),st(t).find(n).off("click",tt),st(t).find(n).on("click",tt),S(),P(),W(),it(),et()},_=function(t){for(var e=F(dt.CONTAINER),n=F(dt.MAIN),i=F(dt.DAYS_HEADING),a=F(dt.DAY_CELL),s=F(dt.WEEK_ROW),o=F(dt.EVENTS_CONTAINER),l=(A.settings.hideViewOptions||F(dt.VIEWS),F(dt.ADD_MENU),X(A.settings.month-1)),d=G(),r="",c="",h=0;h<t.length;h++){for(var E="",u=0;u<t[h].length;u++){var T="",v=t[h][u].toString(),_=t[h][u-1]?t[h][u-1].toString():"",N=a.replace("{content}",t[h][u]);if(v.length<1)T+=" "+ot.EMPTY_DAY+" ",0==u&&v.length<1&&(T+=" "+ot.EMPTY_DAY_BEGINNING+" "),_&&g()==_.trim()&&(T+=" "+ot.EMPTY_DAY_ENDING+" "),N=N.replace("{date}","");else{T+=" "+ot.DATE_DAY;var f=new Date(A.settings.month+"/"+t[h][u]+"/"+A.settings.year);N=N.replace("{date}",f.getTime())}E+=N=N.replace("{classnames}",T)}var m=F(s);m=m.replace("{row}",h+1),c+=o.replace("{row}",h+1),r+=m.replace("{content}",E)}var p="";return p+=" "+ot.MONTH_CALENDAR.replace("{month}",l.toLowerCase())+" ",p+=" "+ot.SEASON_CALENDAR.replace("{season}",d?d.name:"")+" ",n=(n=(n=n.replace("{content}",r)).replace("{heading}",i)).replace("{classnames}",p),e=(e=(e=(e=e.replace("{header}",D())).replace("{calendar}",n)).replace("{event-containers}",c)).replace("{add_menu}",O())},N=function(){var t=g(A.settings.month,A.settings.year),e=new Date(A.settings.year,A.settings.month-1,1).getDay();return Y(f(e,t),7)},f=function(t,e){var n=[];for(i=0;i<35;i++)i>=t&&i-t<e?n.push(i-t+1):n.push("");return n},g=function(t,e){var n,i="number"==typeof t?t.toString():t;return-1!=["1","3","5","7","8","10","12"].indexOf(i)?n=31:-1!=["4","6","9","11","8"].indexOf(i)?n=30:2==t&&(n=m(e)?29:28),n},m=function(t){return t%4==0},p=function(){var t=lt.DATE_CELL_CONTENT,e=st(lt.CONTAINER+" "+lt.CALENDAR+" "+lt.WEEK_ROW+" "+lt.DATE_CELL),n=st(e[0]).outerWidth()>A.settings.cellMaxHeigh?A.settings.cellMaxHeigh+"px":st(e[0]).outerWidth()+"px";"monthly"!=A.settings.view&&(n="initial"),e.find(t).css({height:n}),V()},I=function(){for(var t=st(lt.CONTAINER+" "+lt.CALENDAR+" "+lt.WEEK_ROW+" "+lt.DATE_CELL),e=st(t[0]).outerWidth(),n=0,i=0;i<t.length;i++){var a=t.eq(i);if(a.hasClass(ot.EMPTY_DAY)){var s=n*e;s=s<=0?0:-s,a.css({backgroundPosition:s+"px 0px"}),n++}}},S=function(){var t=F(lt.CONTROL_BUTTONS);st(t).off("click",R),st(t).on("click",R)},R=function(t){var e=t.target,n=st(e).attr("left"),i=st(e).attr("right"),a=F(A.settings),s=void 0!==n?"left":void 0;s=void 0!==i?"right":s,"monthly"==a.view&&C(s),"weekly"==a.view&&y(s),"daily"==a.view&&b(s)},C=function(t){var e=F(A.settings);"left"==t?(e.year=e.month<=1?e.year-1:e.year,e.month=e.month<=1?e.month=12:e.month-1):"right"==t&&(e.year=12<=e.month?e.year+1:e.year,e.month=12<=e.month?e.month=1:e.month+1),A.settings=st.extend({},A.settings,e),n()},y=function(t){F(A.settings);"left"==t?l=moment(l).subtract(8,"day"):"right"==t&&(l=moment(d).add(1,"day")),d=moment(l).add(6,"day"),n()},b=function(t){F(A.settings);"left"==t?a=moment(a).subtract(1,"day"):"right"==t&&(a=moment(a).add(1,"day")),n()},M=function t(e){var n=lt.ADD_MENU_BUTTON;switch(st(lt.CONTAINER).find(n).off("click",t),st(e.currentTarget).attr("data-action")){case"add-event":L();break;case"cancel":w()}v()},L=function(){var t=0<A.selection.length?A.selection[0]:null,e=1<A.selection.length?A.selection[1]:t;if(null!=t){var n={startDate:new Date(t),endDate:new Date(e)};A.modal.show(n),w()}},w=function(){A.selection=[],W()},k=function(t){var e=new Date(t.startDate),n=new Date(t.endDate),i={title:t.title,startDate:e,endDate:n,startTime:t.startTime,endTime:t.endTime};A.editModal.show(i,t.id)},P=function(){var t=lt.DATE_DAY;st(t).off("click",H),st(t).on("click",H)},H=function t(e){st(lt.DATE_DAY).off("click",t);var n=e.currentTarget;if(!st(e.target).hasClass("cp-ev-event")&&!st(e.target).hasClass("cp-ev-event-label")){var i=st(n).attr("data-date"),a=0<A.selection.length?A.selection[0]:0,s=1<A.selection.length?A.selection[1]:a;null!=i&&(i=parseInt(i),a<1||0<a&&i<a?A.selection[0]=i:i==a&&s==a?A.selection=[]:i==a?A.selection=[a]:A.selection[1]=i),W()}P()},W=function(){var t=lt.CALENDAR,e=lt.DATE_DAY,n=ot.DATE_SELECTED,i=st(t).find(e),a=0<A.selection.length?A.selection[0]:0,s=1<A.selection.length?A.selection[1]:a;if(i&&0<i.length)for(var o=0;o<i.length;o++){var l=i.eq(o),d=st(l).attr("data-date");if(null!=d)a<=(d=parseInt(d))&&d<=s?st(l).hasClass(n)||st(l).addClass(n):st(l).hasClass(n)&&st(l).removeClass(n)}U()},U=function(){var t=lt.CONTAINER,e=lt.ADD_MENU_CONTAINER,n=lt.DATE_SELECTED,i=ot.ADD_MENU_VISIBLE,a=st(t),s=a.find(n),o=a.find(e);s&&0<s.length?o.hasClass(i)||o.addClass(i):o.hasClass(i)&&o.removeClass(i),V()},V=function(){var t=lt.ADD_MENU_CONTAINER,e=lt.CONTAINER,n=ot.ADD_MENU_ABOVE,i=q(),a=st(e).find(t),s=$();if(null!=i&&null!=i){var o=i.offset(),l=o?o.left:0,d=o?o.top+i.outerHeight()-10:0;i.outerWidth()>a.outerWidth()?l+=(i.outerWidth()-a.outerWidth())/2:l-=(a.outerWidth()-i.outerWidth())/2,a.outerHeight()+d>s.height?(d=o?o.top-a.outerHeight()+10:0,a.hasClass(n)||a.addClass(n)):a.hasClass(n)&&a.removeClass(n),a.css({top:d,left:l})}},x=function(){for(var t,e,n,i,a,s,o=lt.CONTAINER,l=lt.CALENDAR,d=lt.WEEK_EVENTS,r=lt.WEEK_ROW,c=(ot.EVENTS_CONTAINER_READY,st(o).find(d)),h=st(l).position(),E=st(o).outerHeight(),u=0;u<c.length;u++){var T=(t=c.eq(u)).children("button.cp-ev-event");if(n=(e=st(l).find(r+'[data-row="'+t.attr("data-row")+'"]')).position(),i=e.outerWidth,a=e.outerHeight(),s=E-(h.top+n.top)-a+10,0<T.length)s+=T.first().outerHeight()*T.length;t.css({left:n.left,bottom:s,width:i})}B()},B=function(){for(var t=0;t<A.eventInstances.length;t++){A.eventInstances[t].reposition()}},Y=function(t,e){for(var n=[],i=0;i<t.length;i+=e)n.push(t.slice(i,i+e));return n},F=function(t){return JSON.parse(JSON.stringify(t))},X=function(t){return null==ct[t]?"":ct[t]},G=function(){for(var t in A.settings.seasons){var e=A.settings.seasons[t];if(null!=e&&-1!=e.months.indexOf(A.settings.month))return{name:t,display_name:e.display_name}}return null},q=function(){var t=0<A.selection.length?A.selection[0]:null,e=1<A.selection.length?A.selection[1]:t;return e&&(e=st(lt.CONTAINER).find('[data-date="'+e+'"]')),e},$=function(){return{width:st(document).outerWidth(),height:st(document).outerHeight()}},K=function(){i&&4!=i.readyState&&i.abort();var t=A.settings.list_url||A.settings.url||null;if(t)var e=st.extend({},A.settings.data,{month:A.settings.month,year:A.settings.year}),n=st.extend({},A.settings.headers),i=st.ajax({url:t,method:"GET",data:e,headers:n}).done(z).fail(J)},z=function(t){A.events=j(t),function(){T();for(var t,e,n,i,a,s=lt.CALENDAR,o=lt.WEEK_ROW,l=lt.DATE_CELL,d=lt.DATE_CELL_CONTENT,r=(st(s).find(o),st(s).find(l)),c=0;c<r.length;c++){n=(e=r.eq(c)).attr("data-date");for(var h=0;h<A.events.length;h++){var E=A.events[h];i=new Date(E.startDate).getTime(),a=new Date(E.endDate).getTime(),i<=n&&n<=a&&((t=new CPEvent(E,e.find(d),void 0,l,{onClick:k})).render(),A.eventInstances.push(t))}}x()}()},J=function(t){if("abort"!=t.statusText){var e="Failed to load events.";e=t.message&&0<t.message.length?t.message:e}},j=function(t){if(null===A.settings.respData)return t;if("string"!=typeof A.settings.respData)return console.error(new Error("Data path invalid, please contact system's admin.")),t;var e=F(A.settings.respData);e=(e=e.trim()).split(".");for(var n=F(t),i=0;i<e.length;i++)n.hasOwnProperty(e[i])&&(n=n[e[i]]);if(n)for(i=0;i<n.length;i++)n[i]=Q(n[i]);return n},Q=function(t){return{id:Z(t,A.settings.id),title:Z(t,A.settings.title),startDate:Z(t,A.settings.startDate),endDate:Z(t,A.settings.endDate),startTime:Z(t,A.settings.startTime),endTime:Z(t,A.settings.endTime)}},Z=function(t,e){if("string"!=typeof e)return console.error(new Error("Data path invalid, please contact system's admin.")),t;var n=F(e);n=(n=n.trim()).split(".");for(var i=F(t),a=!1,s=0;s<n.length;s++)i.hasOwnProperty(n[s])&&(i=i[n[s]],a=!0);return a?i:null},tt=function(t){t.preventDefault();var e=st(t.currentTarget),n=lt.CONTAINER_ID;e.attr("data-format"),st("#"+n)},et=function(){st(lt.VIEW_SELECTOR).off("click",nt),st(lt.VIEW_SELECTOR).on("click",nt)},nt=function(t){var e=st(t.currentTarget).attr("data-option");-1==A.viewOptions.indexOf(e)&&(e="monthly"),A.settings.view!=e&&(A.settings=st.extend({},A.settings,{view:e}),w(),setTimeout(n,200))},it=function(){var t=lt.VIEWS_LIST_CONTAINER,e=st(t).find("[data-option='"+A.settings.view+"']");0<e.length&&(e.hasClass(ot.ACTIVE)||(st(t).find("[data-toggle='calendar-view']").removeClass(ot.ACTIVE),e.addClass(ot.ACTIVE)))},at=function(t){return"number"==typeof t&&(t=t.toString()),2<=t.trim().length?t:"0"+t}};st.fn.CalendarPlugin=t.init,st.fn.call=function(t,e,n){return t.apply(n||this,e),this}}(jQuery);var _createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CPEventFormModal=function(){function n(t,e){_classCallCheck(this,n),this.uniqueID=t,this.id=null,this.modal=null,this.PREFIX="cp-ef",this.options=$.extend({url:null,edit:!1,onWillShow:null,onShown:null,onWillHide:null,onHidden:null,onDelete:null},e),this.html=this.html.bind(this),this.render=this.render.bind(this),this.SELECTORS=this.SELECTORS.bind(this),this.CLASSNAMES=this.CLASSNAMES.bind(this),this.componentDidRender=this.componentDidRender.bind(this)}return _createClass(n,[{key:"SELECTORS",value:function(){return{BODY:"body",FORM:"."+this.PREFIX+"-form",FIELDSET:"fieldset",MODAL:"."+this.PREFIX+"-modal",BUTTON:"."+this.PREFIX+"-button",TITLE:'input[name="event-title"]',END_TIME:'input[name="end-time"]',END_DATE:'input[name="end-date"]',START_DATE:'input[name="start-date"]',START_TIME:'input[name="start-time"]',ERROR_CONTAINER:"."+this.PREFIX+"-error-container"}}},{key:"CLASSNAMES",value:function(){return{SHOW:"show",CANCEL:"cancel",SAVE:"save",DELETE:"delete"}}}]),_createClass(n,[{key:"componentDidRender",value:function(){this.modal=$("#"+this.uniqueID),this.listeners(),this.initializePickers()}},{key:"render",value:function(){var t=this.SELECTORS(),e=(t.MODAL,t.BODY),n=$("#"+this.uniqueID);0<n.length&&n.remove(),$(this.html()).attr("id",this.uniqueID).appendTo(e),this.componentDidRender()}},{key:"html",value:function(){return"<div class='"+this.PREFIX+"-modal'><div class='"+this.PREFIX+"-backdrop'>&nbsp;</div><div class='"+this.PREFIX+"-content'><div class='"+this.PREFIX+"-dialog'><form action='javascript:;' class='"+this.PREFIX+"-form' method='POST'><fieldset><p class='"+this.PREFIX+"-error "+this.PREFIX+"-error-container'></p><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><input type='text' name='event-title' class='"+this.PREFIX+"-title' placeholder='Event title...' /></div></div><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><label for='start-date'>Start Date</label><input type='text' name='start-date' placeholder='MM/DD/YYYY' autocomplete='off' /></div><div class='"+this.PREFIX+"-control'><label for='end-date'>End Date</label><input type='text' name='end-date' placeholder='MM/DD/YYYY' autocomplete='off' /></div></div><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><label for='start-time'>Start Time</label><input type='time' name='start-time' placeholder='hh:mm AM/PM' /></div><div class='"+this.PREFIX+"-control'><label for='end-time'>End Time</label><input type='time' name='end-time' placeholder='hh:mm AM/PM' /></div></div><div class='"+this.PREFIX+"-actions'>"+this.delete_button()+"<button type='button' class='"+this.PREFIX+"-button cancel'>Cancel</button><button type='submit' class='"+this.PREFIX+"-button save'>Save</button></div></fieldset></form></div></div></div>"}},{key:"listeners",value:function(){var t=this.SELECTORS(),e=t.BUTTON,n=t.FORM;this.modal.find(e).off("click",this.handle_button_click.bind(this)),this.modal.find(e).on("click",this.handle_button_click.bind(this)),this.modal.find(n).off("submit",this.handle_form_submit.bind(this)),this.modal.find(n).on("submit",this.handle_form_submit.bind(this)),this.modal.find(n).off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",this.handle_form_transition_end.bind(this)),this.modal.find(n).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",this.handle_form_transition_end.bind(this))}},{key:"initializePickers",value:function(){var t=this.SELECTORS(),e=t.START_DATE,n=t.END_DATE;this.modal.find(e).datepicker("destroy"),this.modal.find(e).datepicker(),this.modal.find(n).datepicker("destroy"),this.modal.find(n).datepicker()}},{key:"handle_button_click",value:function(t){var e=this.CLASSNAMES(),n=e.CANCEL,i=(e.SAVE,e.DELETE),a=$(t.currentTarget);a.hasClass(n)&&this.hide(),a.hasClass(i)&&this.confirm_delete()}},{key:"handle_form_submit",value:function(t){t.preventDefault(),this.validate()?this.show_validation_error():(this.hide_validation_error(),this.save())}},{key:"delete_button",value:function(){return this.options.editting?"<button type='button' class='"+this.PREFIX+"-button delete'>Delete</button>":""}},{key:"handle_form_transition_end",value:function(t){}},{key:"show",value:function(t,e){if(this.has_rendered()){this.reset(t),this.id=e||null;var n=this.CLASSNAMES().SHOW;this.modal.hasClass(n)||this.modal.addClass(n)}}},{key:"confirm_delete",value:function(){confirm("Are you sure you want to delete, this event?"),this.delete()}},{key:"hide",value:function(){if(this.has_rendered()){var t=this.CLASSNAMES().SHOW;this.modal.hasClass(t)&&this.modal.removeClass(t)}}},{key:"has_rendered",value:function(){return null!=this.modal&&null!=this.modal&&0<this.modal.length}},{key:"reset",value:function(t){var e=this.SELECTORS(),n=e.START_DATE,i=e.END_DATE,a=e.START_TIME,s=e.END_TIME,o=e.TITLE,l=t.startDate?this.format_date(t.startDate):"",d=t.endDate?this.format_date(t.endDate):"",r=t.startTime||"",c=t.endTime||"",h=t.title||"";this.modal.find(n).val(l),this.modal.find(i).val(d),this.modal.find(a).val(r),this.modal.find(s).val(c),this.modal.find(o).val(h),this.hide_validation_error()}},{key:"format_date",value:function(t){var e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return this.leading_zero(n)+"/"+this.leading_zero(i)+"/"+e}},{key:"leading_zero",value:function(t){return"string"!=typeof t&&"number"!=typeof t?"0":("number"==typeof t&&(t=t.toString()),1<t.length?t:"0"+t)}},{key:"validate",value:function(){if(!this.modal)return"An unknow error has occured.";var t=this.get_form_data();return!t.title||t.title.length<1?"Please enter and event title.":!t.startDate||t.startDate.length<1?"Please select a start date.":"Invalid Date"==new Date(t.startDate)?"Start date is not a valid date.":!t.endDate||t.endDate.length<1?"Please select an end date.":"Invalid Date"==new Date(t.endDate)?"End date is not a valid date.":!t.startTime||t.startTime.length<1?"Please specify a start time.":this.time_regex(t.startTime)?!t.endTime||t.endTime.length<1?"Please specify a end time.":!this.time_regex(t.endTime)&&"End time invalid. E.g hh:mm AM/PM.":"Start time invalid. E.g hh:mm AM/PM."}},{key:"show_validation_error",value:function(){var t=this.validate();if(t){var e=this.SELECTORS(),n=e.FORM,i=e.ERROR_CONTAINER,a=this.CLASSNAMES().SHOW,s=this.modal.find(n).find(i);!s||s.length<1||(s.text(t),s.hasClass(a)||s.addClass(a))}}},{key:"hide_validation_error",value:function(){var t=this.SELECTORS(),e=t.FORM,n=t.ERROR_CONTAINER,i=this.CLASSNAMES().SHOW,a=this.modal.find(e).find(n);!a||a.length<1||(a.text(""),a.hasClass(i)&&a.removeClass(i))}},{key:"disable",value:function(t){var e=this.SELECTORS(),n=e.FORM,i=e.FIELDSET,a=e.BUTTON;t=!!t,this.modal.find(n).find(i).attr("disabled",t),this.modal.find(n).find(a).attr("disabled",t)}},{key:"time_regex",value:function(t){"string"!=typeof t&&(t+="");return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t)}},{key:"get_form_data",value:function(){var t=this.SELECTORS(),e=t.START_DATE,n=t.END_DATE,i=t.START_TIME,a=t.END_TIME,s=t.TITLE;return{title:this.modal.find(s).val(),startDate:this.modal.find(e).val(),endDate:this.modal.find(n).val(),startTime:this.modal.find(i).val(),endTime:this.modal.find(a).val()}}},{key:"save",value:function(){if(null!=this.build_url()){var t=$.extend({},this.options.data,this.get_form_data());t=this.add_structs(t);var e=$.extend({},this.options.headers);this.disable(!0),$.ajax({url:this.options.url,data:t,headers:e,method:this.options.editting?"PUT":"POST"}).done(this.save_done.bind(this)).fail(this.save_failed.bind(this))}}},{key:"save_done",value:function(t){"function"==typeof this.options.onSaved&&this.options.onSaved();var e=this;setTimeout(function(){e.disable(!1),e.hide()},800)}},{key:"save_failed",value:function(t){this.disable(!1);var e="Failed to"+(this.options.editting?" save changes.":" save new event.");e=t.message&&0<t.message.length?t.message:e;alert(e)}},{key:"add_structs",value:function(t){if(this.options.requestStruct){var e=JSON.parse(JSON.stringify(this.options.requestStruct));for(var n in e)"string"==typeof e[n]&&void 0!==t[n]&&void 0===t[e[n]]&&(t[e[n]]=JSON.parse(JSON.stringify(t[n])),delete t[n])}return t}},{key:"delete",value:function(){if(null!=this.build_url("delete")){var t=$.extend({},this.options.data),e=$.extend({},this.options.headers);this.disable(!0),$.ajax({url:this.options.url,data:t,headers:e,method:"DELETE"}).done(this.delete_done.bind(this)).fail(this.delete_failed.bind(this))}}},{key:"delete_done",value:function(t){"function"==typeof this.options.onDelete&&this.options.onDelete();var e=this;setTimeout(function(){e.disable(!1),e.hide()},800)}},{key:"delete_failed",value:function(t){this.disable(!1);var e="Could not delete event, please try again in a moment.";e=t.message&&0<t.message.length?t.message:e;alert(e)}},{key:"build_url",value:function(t){if(!(t=!!t)&&null==this.options.url||t&&null==this.options.deleteUrl)return null;var e=t?JSON.parse(JSON.stringify(this.options.deleteUrl)):JSON.parse(JSON.stringify(this.options.url)),n=new RegExp(/^(:id)$/,"ig");return this.options.editting?n.test(e)?e=e.replace(n,this.id):this.options.data=$.extend({},this.options.data,{id:this.id}):e=e,e}}]),n}();_createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CPEvent=function(){function o(t,e,n,i,a){_classCallCheck(this,o);var s=new Date;this.PREFIX="cp-ev",this.uniqueID=this.PREFIX+s.getTime()+""+Math.ceil(100*Math.random()),this.container=e,this.week=n,this.cellSelector=i,this.event=null,this.data=t,this.start=null,this.options=$.extend({onClick:null},a),this.html=this.html.bind(this),this.render=this.render.bind(this),this.SELECTORS=this.SELECTORS.bind(this),this.CLASSNAMES=this.CLASSNAMES.bind(this),this.componentDidRender=this.componentDidRender.bind(this),this.reposition=this.reposition.bind(this),this.resize=this.resize.bind(this),this.set_start_end=this.set_start_end.bind(this),this.destroy=this.destroy.bind(this)}return _createClass(o,[{key:"SELECTORS",value:function(){return{BODY:"body",FORM:"."+this.PREFIX+"-form",FIELDSET:"fieldset",MODAL:"."+this.PREFIX+"-modal",BUTTON:"."+this.PREFIX+"-button",TITLE:'input[name="event-title"]',END_TIME:'input[name="end-time"]',END_DATE:'input[name="end-date"]',START_DATE:'input[name="start-date"]',START_TIME:'input[name="start-time"]',ERROR_CONTAINER:"."+this.PREFIX+"-error-container"}}},{key:"CLASSNAMES",value:function(){return{CONTAINER:this.PREFIX+"-event-container",EVENT:this.PREFIX+"-event",LABEL:this.PREFIX+"-event-label",START:"start",END:"end",HIGHLIGHTED:"highlighted"}}}]),_createClass(o,[{key:"componentDidRender",value:function(){this.event=this.container.find("#"+this.uniqueID),this.listeners()}},{key:"render",value:function(){this.container.append(this.html()),this.componentDidRender()}},{key:"html",value:function(){return"<button class='"+this.CLASSNAMES().EVENT+"' id='"+this.uniqueID+"' data-evid='"+this.data.id+"' title='"+this.title()+"'><span class='"+this.CLASSNAMES().LABEL+"'>"+this.data.title+"</span></button>"}},{key:"title",value:function(){return this.data.title+" ("+this.data.startDate+" - "+this.data.endDate+")"}},{key:"listeners",value:function(){"function"==typeof this.options.onClick&&(this.event.off("click",this.handle_on_click.bind(this)),this.event.on("click",this.handle_on_click.bind(this))),this.event.off("mouseenter",this.handle_on_mouse_enter.bind(this)),this.event.on("mouseenter",this.handle_on_mouse_enter.bind(this)),this.event.off("mouseleave",this.handle_on_mouse_leave.bind(this)),this.event.on("mouseleave",this.handle_on_mouse_leave.bind(this))}},{key:"handle_on_click",value:function(t){this.options.onClick(this.data)}},{key:"handle_on_mouse_enter",value:function(t){var e=this.event.attr("data-evid");null!=e&&$('[data-evid="'+e+'"]').addClass(this.CLASSNAMES().HIGHLIGHTED)}},{key:"handle_on_mouse_leave",value:function(t){var e=this.event.attr("data-evid");null!=e&&$('[data-evid="'+e+'"]').removeClass(this.CLASSNAMES().HIGHLIGHTED)}},{key:"reposition",value:function(){}},{key:"resize",value:function(){var t=new Date(this.data.startDate),e=new Date(this.data.endDate),n=this.start.offset().left,i=this.end.offset().left+this.end.outerWidth();t.getTime()==parseInt(this.start.attr("data-date"))&&(n+=15,this.event.hasClass(this.CLASSNAMES().START)||this.event.addClass(this.CLASSNAMES().START)),e.getTime()==parseInt(this.end.attr("data-date"))&&(i-=15,this.event.hasClass(this.CLASSNAMES().END)||this.event.addClass(this.CLASSNAMES().END));var a=i-n;this.event.css({width:a+"px"})}},{key:"set_start_end",value:function(){for(var t=new Date(this.data.startDate),e=new Date(this.data.endDate),n=this.week.find(this.cellSelector),i=null,a=null,s=0;s<n.length;s++){var o=n.eq(s),l=parseInt(o.attr("data-date"));if(null==i&&(i=l>=t.getTime()&&l<=e.getTime()||l==t.getTime()?o:null),null==a&&(n.length-1!=s&&l!=e.getTime()||(a=o)),null!=i&&null!=a)break}this.start=i,this.end=a}},{key:"destroy",value:function(){this.event.remove(),this.event=null}}]),o}();