!function(it){var at={ACTIVE:"active",LOADER_SHOW:"show-loader",CONTAINER:"cp-container",CALENDAR:"cp-calendar",MONTH_CALENDAR:"cp-calendar-{month}",SEASON_CALENDAR:"cp-calendar-{season}",HEADER:"cp-header",HEADER_CONTENT:"cp-header-content",HEADER_OPTIONS_CONTAINER:"cp-header-options-container",HEADER_OPTIONS:"cp-header-options",HEADER_OPTIONS_INNER:"cp-header-options-inner",HEADER_OPTIONS_BUTTONS_CONTAINER:"cp-header-options-buttons-container",HEADER_OPTIONS_BUTTON:"cp-header-options-button",HEADER_OPTIONS_ABOVE:"cp-header-options-above",HEADER_OPTIONS_VISIBLE:"cp-header-options-visible",NAV_CONTROLS:"cp-nav-controls",CONTROLS_CONTAINER:"cp-nav",MONTH_HEADER:"cp-header-{month}",SEASON_HEADER:"cp-header-{season}",DATE_CELL:"cp-date",DATE_DAY:"cp-day",DATE_SELECTED:"cp-date-selected",DATE_CELL_CONTENT:"cp-date-content",WEEK_ROW:"cp-week",WEEK_EVENTS:"cp-week-events",MONTH_HEADING:"cp-month-heading",MONTH_CELL:"cp-month",MONTH_NAME_BUTTON:"cp-month-name",EMPTY_DAY:"cp-empty-day",EMPTY_DAY_BEGINNING:"cp-empty-day-beginning",EMPTY_DAY_ENDING:"cp-empty-day-ending",ADD_MENU_CONTAINER:"cp-add-menu",ADD_MENU_INNER:"cp-add-menu-inner",ADD_MENU_BUTTONS_CONTAINER:"cp-add-menu-buttons-container",ADD_MENU_BUTTON:"cp-add-menu-button",ADD_MENU_ABOVE:"cp-add-menu-above",ADD_MENU_VISIBLE:"cp-add-menu-visible",VIEWS_LIST_CONTAINER:"cp-view-list-container",VIEWS_LIST:"cp-view-list",VIEWS_ITEM:"cp-view",VIEW_BUTTON:"cp-view-button"},st={BODY:"body",CONTAINER:".cp-container",CONTAINER_ID:"cp-container-id",CALENDAR:".cp-calendar",HEADER:".cp-header",HEADER_CONTENT:".cp-header-content",HEADER_OPTIONS_CONTAINER:".cp-header-options-container",HEADER_OPTIONS:".cp-header-options",HEADER_OPTIONS_INNER:".cp-header-options-inner",HEADER_OPTIONS_BUTTONS_CONTAINER:".cp-header-options-buttons-container",HEADER_OPTIONS_BUTTON:".cp-header-options-button",HEADER_OPTIONS_ABOVE:".cp-header-options-above",HEADER_OPTIONS_VISIBLE:".cp-header-options-visible",NAV_CONTROLS:".cp-nav-controls",CONTROL_BUTTONS:"button.cp-nav",DATE_CELL:".cp-date",DATE_DAY:".cp-day",DATE_SELECTED:".cp-date-selected",DATE_CELL_CONTENT:".cp-date-content",WEEK_ROW:".cp-week",WEEK_EVENTS:".cp-week-events",MONTH_HEADING:".cp-month-heading",MONTH_CELL:".cp-month",MONTH_NAME_BUTTON:".cp-month-name",EMPTY_DAY:".cp-empty-day",EMPTY_DAY_BEGINNING:".cp-empty-day-beginning",EMPTY_DAY_ENDING:".cp-empty-day-ending",ADD_MENU_CONTAINER:".cp-add-menu",ADD_MENU_INNER:".cp-add-menu-inner",ADD_MENU_BUTTON:".cp-add-menu-button",ADD_MENU_BUTTONS_CONTAINER:".cp-add-menu-buttons-container",VIEWS_LIST_CONTAINER:".cp-view-list-container",VIEWS_LIST:".cp-view-list",VIEWS_ITEM:".cp-view",VIEW_BUTTON:".cp-view-button",VIEW_SELECTOR:'[data-toggle="calendar-view"]',EVENT_FORM_MODAL:".cp-ef-modal",EXPORT_BUTTON:'[data-export="calendar"]'},ot={CONTAINER:"<div class='"+at.CONTAINER+"' id='"+st.CONTAINER_ID+"'>{header}{calendar}{add_menu}</div>",MAIN:"<table class='"+at.CALENDAR+" {classnames}'  cellspacing='0' cellpadding='0'><thead>{heading}</thead><tbody>{content}</tbody></table>",DAYS_HEADING:"<tr class='"+at.MONTH_HEADING+"'> <th>Sun</th> <th>Mon</th> <th>Tue</th> <th>Wed</th> <th>Thur</th> <th>Fri</th> <th>Sat</th> </tr>",WEEK_ROW:"<tr class='"+at.WEEK_ROW+"' data-row='{row}'>{content}</tr>",DAY_CELL:"<td class='"+at.DATE_CELL+" {classnames}' data-date='{date}'><div class='"+at.DATE_CELL_CONTENT+"'>{content}</div></td>",HEADER:"<div class='"+at.HEADER+" {classnames}'><div class='"+at.NAV_CONTROLS+"'>{left-control}{right-control}</div><div class='"+at.HEADER_CONTENT+"'><div class='"+at.HEADER_OPTIONS_CONTAINER+"'><button class='"+at.MONTH_NAME_BUTTON+"'>{month}<span class='caret'></span></button><div class='"+at.HEADER_OPTIONS+"' id='headerOptionsComponent'><div class='"+at.HEADER_OPTIONS_INNER+"'><div class='"+at.HEADER_OPTIONS_BUTTONS_CONTAINER+"'><a class='"+at.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='pdf'>Export to .pdf</a><a class='"+at.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='docx'>Export to .docx</a></div><span class='caret'></span></div></div></div></div>{view-options}</div>",VIEWS:"<div class='"+at.VIEWS_LIST_CONTAINER+"'><ul class='"+at.VIEWS_LIST+"'><li class='"+at.VIEWS_ITEM+"'><button type='button' class='"+at.VIEW_BUTTON+" daily' data-toggle='calendar-view' data-option='daily'>Daily</button></li><li class='"+at.VIEWS_ITEM+"'><button type='button' class='"+at.VIEW_BUTTON+" weekly' data-toggle='calendar-view' data-option='weekly'>Weekly</button></li><li class='"+at.VIEWS_ITEM+"'><button type='button' class='"+at.VIEW_BUTTON+" monthly' data-toggle='calendar-view' data-option='monthly'>Monthly</button></li></ul></div>",CONTROL:"<button class='"+at.CONTROLS_CONTAINER+"' type='submit' {direction}>{label}</button>",ADD_MENU:"<div class='"+at.ADD_MENU_CONTAINER+"' id='addMenuComponent'><div class='"+at.ADD_MENU_INNER+"'><div class='"+at.ADD_MENU_BUTTONS_CONTAINER+"'><button class='"+at.ADD_MENU_BUTTON+"' type='button' data-action='add-event'>Add Event</button><button class='"+at.ADD_MENU_BUTTON+" cancel' data-action='cancel' type='button'>Cancel</button></div><span class='caret'></span></div></div>"},lt={spring:{display_name:"Spring",months:[3,4,5,6]},summer:{display_name:"Summer",months:[7,8,9]},fall:{display_name:"Fall",months:[10,11]},winter:{display_name:"Winter",months:[12,1,2]}},dt=["January","February","March","April","May","June","July","August","September","October","November","December"],t=new function(){var N=this;N.now=new Date,N.selection=[],N.modal=null,N.editModal=null,N.events=[],N.eventInstances=[],N.viewOptions=["daily","weekly","monthly"];var l=moment(moment().format("YYYY-MM-DD 00:00:00")),d=moment(l).add(6,"days"),a=moment();N.settings={},N.init=function(t){N.el=this,N.settings=it.extend({month:N.now.getMonth()+1,year:N.now.getFullYear(),dayStyle:"short",cellMaxHeigh:200,respData:"data",id:"id",title:"title",startDate:"startDate",endDate:"endDate",startTime:"startTime",endTime:"endTime",creatRequest:null,editRequest:null,view:"monthly",hideViewOptions:!1},t);var e=it.extend(lt,t?t.seasons:{});return N.settings.seasons=e,(N.settings.month<1||12<N.settings.month)&&(N.settings.month=1),n(),N};var n=function(){t(),N.modal=new CPEventFormModal("new-event"+N.now.getTime(),{url:N.settings.createUrl||N.settings.url||null,data:N.settings.data,headers:N.settings.headers,onSaved:q,requestStruct:N.settings.creatRequest||null}),N.modal.render(),N.editModal=new CPEventFormModal("edit-event"+N.now.getTime(),{editting:!0,url:N.settings.editUrl||N.settings.url||null,deleteUrl:N.settings.deleteUrl||N.settings.url||null,data:N.settings.data,headers:N.settings.headers,onSaved:q,onDelete:q,requestStruct:N.settings.editRequest||null}),N.editModal.render()},t=function(){var t="";switch(N.settings.view){case"daily":t=s();break;case"weekly":t=e();break;case"monthly":t=v(_())}it(N.el).html(""),it(t).prependTo(it(N.el)),q(),T()},e=function(){return"<div class='"+at.CONTAINER+"' id='"+st.CONTAINER_ID+"'>"+p("weekly")+"<table class='"+at.CALENDAR+" {classnames} weekly'  cellspacing='0' cellpadding='0'><thead>"+h()+"</thead><tbody>"+c()+"</tbody></table>"+D()+"</div>"},s=function(){return"<div class='"+at.CONTAINER+"' id='"+st.CONTAINER_ID+"'>"+p("daily")+"<table class='"+at.CALENDAR+" {classnames} weekly'  cellspacing='0' cellpadding='0'><thead>"+o()+"</thead><tbody>"+r()+"</tbody></table>"+D()+"</div>"},o=function(){return'<tr class="'+at.MONTH_HEADING+'"><th col-span="0" style="width: initial; text-align: right;">Time</th><th col-span="10" style="width: initial; text-align: center;"></th></tr>'},r=function(){for(var t,e=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],n="",i=0;i<e.length;i++)t=12<=i?"PM":"AM",n+='<tr class="'+at.WEEK_ROW+' daily">\n                            <td col-span="0" style="width: initial; text-align: right; padding-right: 15px;">'+nt(e[i])+" "+t+'</td>\n                            <td col-span="10" style="width: initial;" class="'+at.DATE_CELL+" "+at.DATE_DAY+'" data-date="'+moment(a.format("YYYY-MM-DD "+nt(e[i])+":00:00")).get("time")+'">\n                                <div class="'+at.DATE_CELL_CONTENT+'"></div>\n                            </td>\n                        </tr>';return n},h=function(){for(var t='<tr class="'+at.MONTH_HEADING+'"><th style=" text-align: right;">Time</th>',e=l.get("time");e<=d.get("time");e+=864e5)t+='<th style="text-align: center;">'+moment(e).format("ddd DD")+"</th>";return t+="</tr>"},c=function(){for(var t,e,n,i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],a="",s=0;s<i.length;s++){n=12<=s?"PM":"AM",t=nt(i[s])+" "+n,a+='<tr class="'+at.WEEK_ROW+' weekly"><td style=" text-align: right; padding-right: 15px;">'+t+"</td>";for(var o=l.get("time");o<=d.get("time");o+=864e5)e=moment(moment(o).format("YYYY-MM-DD ")+nt(i[s])+":00:00"),a+='<td class="'+at.DATE_CELL+" "+at.DATE_DAY+'" data-date="'+e.get("time")+'"><div class="'+at.DATE_CELL_CONTENT+'"></div></td>';a+="</tr>"}return a},p=function(t){var e=V(N.settings.month-1),n="";if(n+=" "+at.MONTH_HEADER.replace("{month}",V(N.settings.month-1).toLowerCase())+" ",n+=" "+at.SEASON_HEADER.replace("{season}",F()?F().name:"")+" ","weekly"==t){e=V(l.get("month"));n+=" "+at.MONTH_HEADER.replace("{month}",V(l.get("month")-1).toLowerCase())+" ",e+=" "+nt(l.get("date"))+" - ",e+=d.get("month")!=l.get("month")?V(d.get("month"))+" "+nt(d.get("date")):nt(d.get("date"))}if("daily"==t){e=a.format("Do MMMM YYYY");n+=" "+at.MONTH_HEADER.replace("{month}",V(a.get("month")-1).toLowerCase())+" "}return"<div class='"+at.HEADER+" "+n+"'><div class='"+at.NAV_CONTROLS+"'>"+E("left")+E("right")+"</div><div class='"+at.HEADER_CONTENT+"'><div class='"+at.HEADER_OPTIONS_CONTAINER+"'><button class='"+at.MONTH_NAME_BUTTON+"'>"+e+"<span class='caret'></span></button><div class='"+at.HEADER_OPTIONS+"' id='headerOptionsComponent'><div class='"+at.HEADER_OPTIONS_INNER+"'><div class='"+at.HEADER_OPTIONS_BUTTONS_CONTAINER+"'><a class='"+at.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='pdf'>Export to .pdf</a><a class='"+at.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='docx'>Export to .docx</a></div><span class='caret'></span></div></div></div></div>"+u()+"</div>"},E=function(t){var e="right"==t?"&rarr;":"&larr;";return"<button class='"+at.CONTROLS_CONTAINER+"' type='submit' "+t+">"+e+"</button>"},u=function(){return"<div class='"+at.VIEWS_LIST_CONTAINER+"'><ul class='"+at.VIEWS_LIST+"'><li class='"+at.VIEWS_ITEM+"'><button type='button' class='"+at.VIEW_BUTTON+" daily' data-toggle='calendar-view' data-option='daily'>Day</button></li><li class='"+at.VIEWS_ITEM+"'><button type='button' class='"+at.VIEW_BUTTON+" weekly' data-toggle='calendar-view' data-option='weekly'>Week</button></li><li class='"+at.VIEWS_ITEM+"'><button type='button' class='"+at.VIEW_BUTTON+" monthly' data-toggle='calendar-view' data-option='monthly'>Month</button></li></ul></div>"},D=function(){return"<div class='"+at.ADD_MENU_CONTAINER+"' id='addMenuComponent'><div class='"+at.ADD_MENU_INNER+"'><div class='"+at.ADD_MENU_BUTTONS_CONTAINER+"'><button class='"+at.ADD_MENU_BUTTON+"' type='button' data-action='add-event'>Add Event</button><button class='"+at.ADD_MENU_BUTTON+" cancel' data-action='cancel' type='button'>Cancel</button></div><span class='caret'></span></div></div>"},m=function(){for(var t=0;t<N.eventInstances.length;t++){N.eventInstances[t].destroy()}N.eventInstances=[]},T=function(){var t=st.CONTAINER,e=st.ADD_MENU_BUTTON,n=st.EXPORT_BUTTON;g(),it(window).off("resize",g),it(window).on("resize",g),S(),it(window).off("resize",S),it(window).on("resize",S),it(t).find(e).off("click",M),it(t).find(e).on("click",M),it(t).find(n).off("click",Q),it(t).find(n).on("click",Q),I(),P(),Y(),et(),Z()},v=function(t){for(var e=B(ot.CONTAINER),n=B(ot.MAIN),i=B(ot.DAYS_HEADING),a=B(ot.DAY_CELL),s=B(ot.WEEK_ROW),o=(N.settings.hideViewOptions||B(ot.VIEWS),B(ot.ADD_MENU),V(N.settings.month-1)),l=F(),d="",r=0;r<t.length;r++){for(var h="",c=0;c<t[r].length;c++){var E="",u=t[r][c].toString(),T=t[r][c-1]?t[r][c-1].toString():"",m=a.replace("{content}",t[r][c]);if(u.length<1)E+=" "+at.EMPTY_DAY+" ",0==c&&u.length<1&&(E+=" "+at.EMPTY_DAY_BEGINNING+" "),T&&A()==T.trim()&&(E+=" "+at.EMPTY_DAY_ENDING+" "),m=m.replace("{date}","");else{E+=" "+at.DATE_DAY;var v=new Date(N.settings.month+"/"+t[r][c]+"/"+N.settings.year);m=m.replace("{date}",v.getTime())}h+=m=m.replace("{classnames}",E)}var _=B(s);d+=(_=_.replace("{row}",r+1)).replace("{content}",h)}var f="";return f+=" "+at.MONTH_CALENDAR.replace("{month}",o.toLowerCase())+" ",f+=" "+at.SEASON_CALENDAR.replace("{season}",l?l.name:"")+" ",n=(n=(n=n.replace("{content}",d)).replace("{heading}",i)).replace("{classnames}",f),e=(e=(e=e.replace("{header}",p())).replace("{calendar}",n)).replace("{add_menu}",D())},_=function(){var t=A(N.settings.month,N.settings.year),e=new Date(N.settings.year,N.settings.month-1,1).getDay();return x(f(e,t),7)},f=function(t,e){var n=[];for(i=0;i<35;i++)i>=t&&i-t<e?n.push(i-t+1):n.push("");return n},A=function(t,e){var n,i="number"==typeof t?t.toString():t;return-1!=["1","3","5","7","8","10","12"].indexOf(i)?n=31:-1!=["4","6","9","11","8"].indexOf(i)?n=30:2==t&&(n=O(e)?29:28),n},O=function(t){return t%4==0},g=function(){var t=st.DATE_CELL_CONTENT,e=it(st.CONTAINER+" "+st.CALENDAR+" "+st.WEEK_ROW+" "+st.DATE_CELL),n=it(e[0]).outerWidth()>N.settings.cellMaxHeigh?N.settings.cellMaxHeigh+"px":it(e[0]).outerWidth()+"px";"monthly"!=N.settings.view&&(n="initial"),e.find(t).css({height:n}),W()},S=function(){for(var t=it(st.CONTAINER+" "+st.CALENDAR+" "+st.WEEK_ROW+" "+st.DATE_CELL),e=it(t[0]).outerWidth(),n=0,i=0;i<t.length;i++){var a=t.eq(i);if(a.hasClass(at.EMPTY_DAY)){var s=n*e;s=s<=0?0:-s,a.css({backgroundPosition:s+"px 0px"}),n++}}},I=function(){var t=B(st.CONTROL_BUTTONS);it(t).off("click",R),it(t).on("click",R)},R=function(t){var e=t.target,n=it(e).attr("left"),i=it(e).attr("right"),a=B(N.settings),s=void 0!==n?"left":void 0;s=void 0!==i?"right":s,"monthly"==a.view&&C(s),"weekly"==a.view&&y(s),"daily"==a.view&&b(s)},C=function(t){var e=B(N.settings);"left"==t?(e.year=e.month<=1?e.year-1:e.year,e.month=e.month<=1?e.month=12:e.month-1):"right"==t&&(e.year=12<=e.month?e.year+1:e.year,e.month=12<=e.month?e.month=1:e.month+1),N.settings=it.extend({},N.settings,e),n()},y=function(t){B(N.settings);"left"==t?l=moment(l).subtract(8,"day"):"right"==t&&(l=moment(d).add(1,"day")),d=moment(l).add(6,"day"),n()},b=function(t){B(N.settings);"left"==t?a=moment(a).subtract(1,"day"):"right"==t&&(a=moment(a).add(1,"day")),n()},M=function t(e){var n=st.ADD_MENU_BUTTON;switch(it(st.CONTAINER).find(n).off("click",t),it(e.currentTarget).attr("data-action")){case"add-event":L();break;case"cancel":w()}T()},L=function(){var t=0<N.selection.length?N.selection[0]:null,e=1<N.selection.length?N.selection[1]:t;if(null!=t){var n={startDate:new Date(t),endDate:new Date(e)};N.modal.show(n),w()}},w=function(){N.selection=[],Y()},k=function(t){var e=new Date(t.startDate),n=new Date(t.endDate),i={title:t.title,startDate:e,endDate:n,startTime:t.startTime,endTime:t.endTime};N.editModal.show(i,t.id)},P=function(){var t=st.DATE_DAY;it(t).off("click",H),it(t).on("click",H)},H=function t(e){it(st.DATE_DAY).off("click",t);var n=e.currentTarget;if(!it(e.target).hasClass("cp-ev-event")&&!it(e.target).hasClass("cp-ev-event-label")){var i=it(n).attr("data-date"),a=0<N.selection.length?N.selection[0]:0,s=1<N.selection.length?N.selection[1]:a;null!=i&&(i=parseInt(i),a<1||0<a&&i<a?N.selection[0]=i:i==a&&s==a?N.selection=[]:i==a?N.selection=[a]:N.selection[1]=i),Y()}P()},Y=function(){var t=st.CALENDAR,e=st.DATE_DAY,n=at.DATE_SELECTED,i=it(t).find(e),a=0<N.selection.length?N.selection[0]:0,s=1<N.selection.length?N.selection[1]:a;if(i&&0<i.length)for(var o=0;o<i.length;o++){var l=i.eq(o),d=it(l).attr("data-date");if(null!=d)a<=(d=parseInt(d))&&d<=s?it(l).hasClass(n)||it(l).addClass(n):it(l).hasClass(n)&&it(l).removeClass(n)}U()},U=function(){var t=st.CONTAINER,e=st.ADD_MENU_CONTAINER,n=st.DATE_SELECTED,i=at.ADD_MENU_VISIBLE,a=it(t),s=a.find(n),o=a.find(e);s&&0<s.length?o.hasClass(i)||o.addClass(i):o.hasClass(i)&&o.removeClass(i),W()},W=function(){var t=st.ADD_MENU_CONTAINER,e=st.CONTAINER,n=at.ADD_MENU_ABOVE,i=X(),a=it(e).find(t),s=G();if(null!=i&&null!=i){var o=i.offset(),l=o?o.left:0,d=o?o.top+i.outerHeight()-10:0;i.outerWidth()>a.outerWidth()?l+=(i.outerWidth()-a.outerWidth())/2:l-=(a.outerWidth()-i.outerWidth())/2,a.outerHeight()+d>s.height?(d=o?o.top-a.outerHeight()+10:0,a.hasClass(n)||a.addClass(n)):a.hasClass(n)&&a.removeClass(n),a.css({top:d,left:l})}},x=function(t,e){for(var n=[],i=0;i<t.length;i+=e)n.push(t.slice(i,i+e));return n},B=function(t){return JSON.parse(JSON.stringify(t))},V=function(t){return null==dt[t]?"":dt[t]},F=function(){for(var t in N.settings.seasons){var e=N.settings.seasons[t];if(null!=e&&-1!=e.months.indexOf(N.settings.month))return{name:t,display_name:e.display_name}}return null},X=function(){var t=0<N.selection.length?N.selection[0]:null,e=1<N.selection.length?N.selection[1]:t;return e&&(e=it(st.CONTAINER).find('[data-date="'+e+'"]')),e},G=function(){return{width:it(document).outerWidth(),height:it(document).outerHeight()}},q=function(){i&&4!=i.readyState&&i.abort();var t=N.settings.list_url||N.settings.url||null;if(t)var e=it.extend({},N.settings.data,{month:N.settings.month,year:N.settings.year}),n=it.extend({},N.settings.headers),i=it.ajax({url:t,method:"GET",data:e,headers:n}).done($).fail(J)},$=function(t){N.events=z(t),function(){m();for(var t,e,n,i,a,s=st.CALENDAR,o=st.WEEK_ROW,l=st.DATE_CELL,d=st.DATE_CELL_CONTENT,r=(it(s).find(o),it(s).find(l)),h=0;h<r.length;h++)if(e=r.eq(h),"number"==typeof(n=parseInt(e.attr("data-date")))&&0<=n)for(var c=0;c<N.events.length;c++){var E=N.events[c];if(i=new Date(E.startDate+" "+E.startTime).getTime(),a=new Date(E.endDate+" "+E.endTime).getTime(),n>=moment(moment(i).format("YYYY-MM-DD 00:00:00")).get("time")&&n<=moment(moment(a).format("YYYY-MM-DD 23:59:59")).get("time")){var u=moment(moment(n).format("YYYY-MM-DDT"+E.startTime)).get("time"),T=moment(moment(n).format("YYYY-MM-DDT"+E.endTime)).get("time");("monthly"==N.settings.view||u<=n&&n<=T)&&((t=new CPEvent(E,e.find(d),void 0,l,{onClick:k})).render(),N.eventInstances.push(t))}}}()},J=function(t){if("abort"!=t.statusText){var e="Failed to load events.";e=t.message&&0<t.message.length?t.message:e}},z=function(t){if(null===N.settings.respData)return t;if("string"!=typeof N.settings.respData)return console.error(new Error("Data path invalid, please contact system's admin.")),t;var e=B(N.settings.respData);e=(e=e.trim()).split(".");for(var n=B(t),i=0;i<e.length;i++)n.hasOwnProperty(e[i])&&(n=n[e[i]]);if(n)for(i=0;i<n.length;i++)n[i]=K(n[i]);return n},K=function(t){return{id:j(t,N.settings.id),title:j(t,N.settings.title),startDate:j(t,N.settings.startDate),endDate:j(t,N.settings.endDate),startTime:j(t,N.settings.startTime),endTime:j(t,N.settings.endTime)}},j=function(t,e){if("string"!=typeof e)return console.error(new Error("Data path invalid, please contact system's admin.")),t;var n=B(e);n=(n=n.trim()).split(".");for(var i=B(t),a=!1,s=0;s<n.length;s++)i.hasOwnProperty(n[s])&&(i=i[n[s]],a=!0);return a?i:null},Q=function(t){t.preventDefault();var e=it(t.currentTarget),n=st.CONTAINER_ID;e.attr("data-format"),it("#"+n)},Z=function(){it(st.VIEW_SELECTOR).off("click",tt),it(st.VIEW_SELECTOR).on("click",tt)},tt=function(t){var e=it(t.currentTarget).attr("data-option");-1==N.viewOptions.indexOf(e)&&(e="monthly"),N.settings.view!=e&&(N.settings=it.extend({},N.settings,{view:e}),w(),setTimeout(n,200))},et=function(){var t=st.VIEWS_LIST_CONTAINER,e=it(t).find("[data-option='"+N.settings.view+"']");0<e.length&&(e.hasClass(at.ACTIVE)||(it(t).find("[data-toggle='calendar-view']").removeClass(at.ACTIVE),e.addClass(at.ACTIVE)))},nt=function(t){return"number"==typeof t&&(t=t.toString()),2<=t.trim().length?t:"0"+t}};it.fn.CalendarPlugin=t.init,it.fn.call=function(t,e,n){return t.apply(n||this,e),this}}(jQuery);var _createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CPEventFormModal=function(){function n(t,e){_classCallCheck(this,n),this.uniqueID=t,this.id=null,this.modal=null,this.PREFIX="cp-ef",this.options=$.extend({url:null,edit:!1,onWillShow:null,onShown:null,onWillHide:null,onHidden:null,onDelete:null},e),this.html=this.html.bind(this),this.render=this.render.bind(this),this.SELECTORS=this.SELECTORS.bind(this),this.CLASSNAMES=this.CLASSNAMES.bind(this),this.componentDidRender=this.componentDidRender.bind(this)}return _createClass(n,[{key:"SELECTORS",value:function(){return{BODY:"body",FORM:"."+this.PREFIX+"-form",FIELDSET:"fieldset",MODAL:"."+this.PREFIX+"-modal",BUTTON:"."+this.PREFIX+"-button",TITLE:'input[name="event-title"]',END_TIME:'input[name="end-time"]',END_DATE:'input[name="end-date"]',START_DATE:'input[name="start-date"]',START_TIME:'input[name="start-time"]',ERROR_CONTAINER:"."+this.PREFIX+"-error-container"}}},{key:"CLASSNAMES",value:function(){return{SHOW:"show",CANCEL:"cancel",SAVE:"save",DELETE:"delete"}}}]),_createClass(n,[{key:"componentDidRender",value:function(){this.modal=$("#"+this.uniqueID),this.listeners(),this.initializePickers()}},{key:"render",value:function(){var t=this.SELECTORS(),e=(t.MODAL,t.BODY),n=$("#"+this.uniqueID);0<n.length&&n.remove(),$(this.html()).attr("id",this.uniqueID).appendTo(e),this.componentDidRender()}},{key:"html",value:function(){return"<div class='"+this.PREFIX+"-modal'><div class='"+this.PREFIX+"-backdrop'>&nbsp;</div><div class='"+this.PREFIX+"-content'><div class='"+this.PREFIX+"-dialog'><form action='javascript:;' class='"+this.PREFIX+"-form' method='POST'><fieldset><p class='"+this.PREFIX+"-error "+this.PREFIX+"-error-container'></p><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><input type='text' name='event-title' class='"+this.PREFIX+"-title' placeholder='Event title...' /></div></div><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><label for='start-date'>Start Date</label><input type='text' name='start-date' placeholder='MM/DD/YYYY' autocomplete='off' /></div><div class='"+this.PREFIX+"-control'><label for='end-date'>End Date</label><input type='text' name='end-date' placeholder='MM/DD/YYYY' autocomplete='off' /></div></div><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><label for='start-time'>Start Time</label><input type='time' name='start-time' placeholder='hh:mm AM/PM' /></div><div class='"+this.PREFIX+"-control'><label for='end-time'>End Time</label><input type='time' name='end-time' placeholder='hh:mm AM/PM' /></div></div><div class='"+this.PREFIX+"-actions'>"+this.delete_button()+"<button type='button' class='"+this.PREFIX+"-button cancel'>Cancel</button><button type='submit' class='"+this.PREFIX+"-button save'>Save</button></div></fieldset></form></div></div></div>"}},{key:"listeners",value:function(){var t=this.SELECTORS(),e=t.BUTTON,n=t.FORM;this.modal.find(e).off("click",this.handle_button_click.bind(this)),this.modal.find(e).on("click",this.handle_button_click.bind(this)),this.modal.find(n).off("submit",this.handle_form_submit.bind(this)),this.modal.find(n).on("submit",this.handle_form_submit.bind(this)),this.modal.find(n).off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",this.handle_form_transition_end.bind(this)),this.modal.find(n).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",this.handle_form_transition_end.bind(this))}},{key:"initializePickers",value:function(){var t=this.SELECTORS(),e=t.START_DATE,n=t.END_DATE;this.modal.find(e).datepicker("destroy"),this.modal.find(e).datepicker(),this.modal.find(n).datepicker("destroy"),this.modal.find(n).datepicker()}},{key:"handle_button_click",value:function(t){var e=this.CLASSNAMES(),n=e.CANCEL,i=(e.SAVE,e.DELETE),a=$(t.currentTarget);a.hasClass(n)&&this.hide(),a.hasClass(i)&&this.confirm_delete()}},{key:"handle_form_submit",value:function(t){t.preventDefault(),this.validate()?this.show_validation_error():(this.hide_validation_error(),this.save())}},{key:"delete_button",value:function(){return this.options.editting?"<button type='button' class='"+this.PREFIX+"-button delete'>Delete</button>":""}},{key:"handle_form_transition_end",value:function(t){}},{key:"show",value:function(t,e){if(this.has_rendered()){this.reset(t),this.id=e||null;var n=this.CLASSNAMES().SHOW;this.modal.hasClass(n)||this.modal.addClass(n)}}},{key:"confirm_delete",value:function(){confirm("Are you sure you want to delete, this event?"),this.delete()}},{key:"hide",value:function(){if(this.has_rendered()){var t=this.CLASSNAMES().SHOW;this.modal.hasClass(t)&&this.modal.removeClass(t)}}},{key:"has_rendered",value:function(){return null!=this.modal&&null!=this.modal&&0<this.modal.length}},{key:"reset",value:function(t){var e=this.SELECTORS(),n=e.START_DATE,i=e.END_DATE,a=e.START_TIME,s=e.END_TIME,o=e.TITLE,l=t.startDate?this.format_date(t.startDate):"",d=t.endDate?this.format_date(t.endDate):"",r=t.startTime||"",h=t.endTime||"",c=t.title||"";this.modal.find(n).val(l),this.modal.find(i).val(d),this.modal.find(a).val(r),this.modal.find(s).val(h),this.modal.find(o).val(c),this.hide_validation_error()}},{key:"format_date",value:function(t){var e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return this.leading_zero(n)+"/"+this.leading_zero(i)+"/"+e}},{key:"leading_zero",value:function(t){return"string"!=typeof t&&"number"!=typeof t?"0":("number"==typeof t&&(t=t.toString()),1<t.length?t:"0"+t)}},{key:"validate",value:function(){if(!this.modal)return"An unknow error has occured.";var t=this.get_form_data();return!t.title||t.title.length<1?"Please enter and event title.":!t.startDate||t.startDate.length<1?"Please select a start date.":"Invalid Date"==new Date(t.startDate)?"Start date is not a valid date.":!t.endDate||t.endDate.length<1?"Please select an end date.":"Invalid Date"==new Date(t.endDate)?"End date is not a valid date.":!t.startTime||t.startTime.length<1?"Please specify a start time.":this.time_regex(t.startTime)?!t.endTime||t.endTime.length<1?"Please specify a end time.":!this.time_regex(t.endTime)&&"End time invalid. E.g hh:mm AM/PM.":"Start time invalid. E.g hh:mm AM/PM."}},{key:"show_validation_error",value:function(){var t=this.validate();if(t){var e=this.SELECTORS(),n=e.FORM,i=e.ERROR_CONTAINER,a=this.CLASSNAMES().SHOW,s=this.modal.find(n).find(i);!s||s.length<1||(s.text(t),s.hasClass(a)||s.addClass(a))}}},{key:"hide_validation_error",value:function(){var t=this.SELECTORS(),e=t.FORM,n=t.ERROR_CONTAINER,i=this.CLASSNAMES().SHOW,a=this.modal.find(e).find(n);!a||a.length<1||(a.text(""),a.hasClass(i)&&a.removeClass(i))}},{key:"disable",value:function(t){var e=this.SELECTORS(),n=e.FORM,i=e.FIELDSET,a=e.BUTTON;t=!!t,this.modal.find(n).find(i).attr("disabled",t),this.modal.find(n).find(a).attr("disabled",t)}},{key:"time_regex",value:function(t){"string"!=typeof t&&(t+="");return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t)}},{key:"get_form_data",value:function(){var t=this.SELECTORS(),e=t.START_DATE,n=t.END_DATE,i=t.START_TIME,a=t.END_TIME,s=t.TITLE;return{title:this.modal.find(s).val(),startDate:this.modal.find(e).val(),endDate:this.modal.find(n).val(),startTime:this.modal.find(i).val(),endTime:this.modal.find(a).val()}}},{key:"save",value:function(){if(null!=this.build_url()){var t=$.extend({},this.options.data,this.get_form_data());t=this.add_structs(t);var e=$.extend({},this.options.headers);this.disable(!0),$.ajax({url:this.options.url,data:t,headers:e,method:this.options.editting?"PUT":"POST"}).done(this.save_done.bind(this)).fail(this.save_failed.bind(this))}}},{key:"save_done",value:function(t){"function"==typeof this.options.onSaved&&this.options.onSaved();var e=this;setTimeout(function(){e.disable(!1),e.hide()},800)}},{key:"save_failed",value:function(t){this.disable(!1);var e="Failed to"+(this.options.editting?" save changes.":" save new event.");e=t.message&&0<t.message.length?t.message:e;alert(e)}},{key:"add_structs",value:function(t){if(this.options.requestStruct){var e=JSON.parse(JSON.stringify(this.options.requestStruct));for(var n in e)"string"==typeof e[n]&&void 0!==t[n]&&void 0===t[e[n]]&&(t[e[n]]=JSON.parse(JSON.stringify(t[n])),delete t[n])}return t}},{key:"delete",value:function(){if(null!=this.build_url("delete")){var t=$.extend({},this.options.data),e=$.extend({},this.options.headers);this.disable(!0),$.ajax({url:this.options.url,data:t,headers:e,method:"DELETE"}).done(this.delete_done.bind(this)).fail(this.delete_failed.bind(this))}}},{key:"delete_done",value:function(t){"function"==typeof this.options.onDelete&&this.options.onDelete();var e=this;setTimeout(function(){e.disable(!1),e.hide()},800)}},{key:"delete_failed",value:function(t){this.disable(!1);var e="Could not delete event, please try again in a moment.";e=t.message&&0<t.message.length?t.message:e;alert(e)}},{key:"build_url",value:function(t){if(!(t=!!t)&&null==this.options.url||t&&null==this.options.deleteUrl)return null;var e=t?JSON.parse(JSON.stringify(this.options.deleteUrl)):JSON.parse(JSON.stringify(this.options.url)),n=new RegExp(/^(:id)$/,"ig");return this.options.editting?n.test(e)?e=e.replace(n,this.id):this.options.data=$.extend({},this.options.data,{id:this.id}):e=e,e}}]),n}();_createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CPEvent=function(){function o(t,e,n,i,a){_classCallCheck(this,o);var s=new Date;this.PREFIX="cp-ev",this.uniqueID=this.PREFIX+s.getTime()+""+Math.ceil(100*Math.random()),this.container=e,this.week=n,this.cellSelector=i,this.event=null,this.data=t,this.start=null,this.options=$.extend({onClick:null},a),this.html=this.html.bind(this),this.render=this.render.bind(this),this.SELECTORS=this.SELECTORS.bind(this),this.CLASSNAMES=this.CLASSNAMES.bind(this),this.componentDidRender=this.componentDidRender.bind(this),this.reposition=this.reposition.bind(this),this.resize=this.resize.bind(this),this.set_start_end=this.set_start_end.bind(this),this.destroy=this.destroy.bind(this)}return _createClass(o,[{key:"SELECTORS",value:function(){return{BODY:"body",FORM:"."+this.PREFIX+"-form",FIELDSET:"fieldset",MODAL:"."+this.PREFIX+"-modal",BUTTON:"."+this.PREFIX+"-button",TITLE:'input[name="event-title"]',END_TIME:'input[name="end-time"]',END_DATE:'input[name="end-date"]',START_DATE:'input[name="start-date"]',START_TIME:'input[name="start-time"]',ERROR_CONTAINER:"."+this.PREFIX+"-error-container"}}},{key:"CLASSNAMES",value:function(){return{CONTAINER:this.PREFIX+"-event-container",EVENT:this.PREFIX+"-event",LABEL:this.PREFIX+"-event-label",START:"start",END:"end",HIGHLIGHTED:"highlighted"}}}]),_createClass(o,[{key:"componentDidRender",value:function(){this.event=this.container.find("#"+this.uniqueID),this.listeners()}},{key:"render",value:function(){this.container.append(this.html()),this.componentDidRender()}},{key:"html",value:function(){return"<button class='"+this.CLASSNAMES().EVENT+"' id='"+this.uniqueID+"' data-evid='"+this.data.id+"' title='"+this.title()+"'><span class='"+this.CLASSNAMES().LABEL+"'>"+this.data.title+"</span></button>"}},{key:"title",value:function(){return this.data.title+" ("+this.data.startDate+" - "+this.data.endDate+")"}},{key:"listeners",value:function(){"function"==typeof this.options.onClick&&(this.event.off("click",this.handle_on_click.bind(this)),this.event.on("click",this.handle_on_click.bind(this))),this.event.off("mouseenter",this.handle_on_mouse_enter.bind(this)),this.event.on("mouseenter",this.handle_on_mouse_enter.bind(this)),this.event.off("mouseleave",this.handle_on_mouse_leave.bind(this)),this.event.on("mouseleave",this.handle_on_mouse_leave.bind(this))}},{key:"handle_on_click",value:function(t){this.options.onClick(this.data)}},{key:"handle_on_mouse_enter",value:function(t){var e=this.event.attr("data-evid");null!=e&&$('[data-evid="'+e+'"]').addClass(this.CLASSNAMES().HIGHLIGHTED)}},{key:"handle_on_mouse_leave",value:function(t){var e=this.event.attr("data-evid");null!=e&&$('[data-evid="'+e+'"]').removeClass(this.CLASSNAMES().HIGHLIGHTED)}},{key:"reposition",value:function(){}},{key:"resize",value:function(){var t=new Date(this.data.startDate),e=new Date(this.data.endDate),n=this.start.offset().left,i=this.end.offset().left+this.end.outerWidth();t.getTime()==parseInt(this.start.attr("data-date"))&&(n+=15,this.event.hasClass(this.CLASSNAMES().START)||this.event.addClass(this.CLASSNAMES().START)),e.getTime()==parseInt(this.end.attr("data-date"))&&(i-=15,this.event.hasClass(this.CLASSNAMES().END)||this.event.addClass(this.CLASSNAMES().END));var a=i-n;this.event.css({width:a+"px"})}},{key:"set_start_end",value:function(){for(var t=new Date(this.data.startDate),e=new Date(this.data.endDate),n=this.week.find(this.cellSelector),i=null,a=null,s=0;s<n.length;s++){var o=n.eq(s),l=parseInt(o.attr("data-date"));if(null==i&&(i=l>=t.getTime()&&l<=e.getTime()||l==t.getTime()?o:null),null==a&&(n.length-1!=s&&l!=e.getTime()||(a=o)),null!=i&&null!=a)break}this.start=i,this.end=a}},{key:"destroy",value:function(){this.event.remove(),this.event=null}}]),o}();