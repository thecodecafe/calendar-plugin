!function(et){var nt={ACTIVE:"active",LOADER_SHOW:"show-loader",CONTAINER:"cp-container",CALENDAR:"cp-calendar",MONTH_CALENDAR:"cp-calendar-{month}",SEASON_CALENDAR:"cp-calendar-{season}",HEADER:"cp-header",HEADER_CONTENT:"cp-header-content",HEADER_OPTIONS_CONTAINER:"cp-header-options-container",HEADER_OPTIONS:"cp-header-options",HEADER_OPTIONS_INNER:"cp-header-options-inner",HEADER_OPTIONS_BUTTONS_CONTAINER:"cp-header-options-buttons-container",HEADER_OPTIONS_BUTTON:"cp-header-options-button",HEADER_OPTIONS_ABOVE:"cp-header-options-above",HEADER_OPTIONS_VISIBLE:"cp-header-options-visible",NAV_CONTROLS:"cp-nav-controls",CONTROLS_CONTAINER:"cp-nav",MONTH_HEADER:"cp-header-{month}",SEASON_HEADER:"cp-header-{season}",DATE_CELL:"cp-date",DATE_DAY:"cp-day",DATE_SELECTED:"cp-date-selected",DATE_CELL_CONTENT:"cp-date-content",WEEK_ROW:"cp-week",WEEK_EVENTS:"cp-week-events",MONTH_HEADING:"cp-month-heading",MONTH_CELL:"cp-month",MONTH_NAME_BUTTON:"cp-month-name",EMPTY_DAY:"cp-empty-day",EMPTY_DAY_BEGINNING:"cp-empty-day-beginning",EMPTY_DAY_ENDING:"cp-empty-day-ending",ADD_MENU_CONTAINER:"cp-add-menu",ADD_MENU_INNER:"cp-add-menu-inner",ADD_MENU_BUTTONS_CONTAINER:"cp-add-menu-buttons-container",ADD_MENU_BUTTON:"cp-add-menu-button",ADD_MENU_ABOVE:"cp-add-menu-above",ADD_MENU_VISIBLE:"cp-add-menu-visible",VIEWS_LIST_CONTAINER:"cp-view-list-container",VIEWS_LIST:"cp-view-list",VIEWS_ITEM:"cp-view",VIEW_BUTTON:"cp-view-button",EVENTS_CONTAINER_READY:"ready"},it={BODY:"body",CONTAINER:".cp-container",CONTAINER_ID:"cp-container-id",CALENDAR:".cp-calendar",HEADER:".cp-header",HEADER_CONTENT:".cp-header-content",HEADER_OPTIONS_CONTAINER:".cp-header-options-container",HEADER_OPTIONS:".cp-header-options",HEADER_OPTIONS_INNER:".cp-header-options-inner",HEADER_OPTIONS_BUTTONS_CONTAINER:".cp-header-options-buttons-container",HEADER_OPTIONS_BUTTON:".cp-header-options-button",HEADER_OPTIONS_ABOVE:".cp-header-options-above",HEADER_OPTIONS_VISIBLE:".cp-header-options-visible",NAV_CONTROLS:".cp-nav-controls",CONTROL_BUTTONS:"button.cp-nav",DATE_CELL:".cp-date",DATE_DAY:".cp-day",DATE_SELECTED:".cp-date-selected",DATE_CELL_CONTENT:".cp-date-content",WEEK_ROW:".cp-week",WEEK_EVENTS:".cp-week-events",MONTH_HEADING:".cp-month-heading",MONTH_CELL:".cp-month",MONTH_NAME_BUTTON:".cp-month-name",EMPTY_DAY:".cp-empty-day",EMPTY_DAY_BEGINNING:".cp-empty-day-beginning",EMPTY_DAY_ENDING:".cp-empty-day-ending",ADD_MENU_CONTAINER:".cp-add-menu",ADD_MENU_INNER:".cp-add-menu-inner",ADD_MENU_BUTTON:".cp-add-menu-button",ADD_MENU_BUTTONS_CONTAINER:".cp-add-menu-buttons-container",VIEWS_LIST_CONTAINER:".cp-view-list-container",VIEWS_LIST:".cp-view-list",VIEWS_ITEM:".cp-view",VIEW_BUTTON:".cp-view-button",VIEW_SELECTOR:'[data-toggle="calendar-view"]',EVENT_FORM_MODAL:".cp-ef-modal",EXPORT_BUTTON:'[data-export="calendar"]'},at={CONTAINER:"<div class='"+nt.CONTAINER+"' id='"+it.CONTAINER_ID+"'>{header}{calendar}{event-containers}{add_menu}</div>",MAIN:"<table class='"+nt.CALENDAR+" {classnames}'  cellspacing='0' cellpadding='0'><thead>{heading}</thead><tbody>{content}</tbody></table>",DAYS_HEADING:"<tr class='"+nt.MONTH_HEADING+"'> <th>Sun</th> <th>Mon</th> <th>Tue</th> <th>Wed</th> <th>Thur</th> <th>Fri</th> <th>Sat</th> </tr>",WEEK_ROW:"<tr class='"+nt.WEEK_ROW+"' data-row='{row}'>{content}</tr>",DAY_CELL:"<td class='"+nt.DATE_CELL+" {classnames}' data-date='{date}'><div class='"+nt.DATE_CELL_CONTENT+"'>{content}</div></td>",HEADER:"<div class='"+nt.HEADER+" {classnames}'><div class='"+nt.NAV_CONTROLS+"'>{left-control}{right-control}</div><div class='"+nt.HEADER_CONTENT+"'><div class='"+nt.HEADER_OPTIONS_CONTAINER+"'><button class='"+nt.MONTH_NAME_BUTTON+"'>{month}<span class='caret'></span></button><div class='"+nt.HEADER_OPTIONS+"' id='headerOptionsComponent'><div class='"+nt.HEADER_OPTIONS_INNER+"'><div class='"+nt.HEADER_OPTIONS_BUTTONS_CONTAINER+"'><a class='"+nt.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='pdf'>Export to .pdf</a><a class='"+nt.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='docx'>Export to .docx</a></div><span class='caret'></span></div></div></div></div>{view-options}</div>",VIEWS:"<div class='"+nt.VIEWS_LIST_CONTAINER+"'><ul class='"+nt.VIEWS_LIST+"'><li class='"+nt.VIEWS_ITEM+"'><button type='button' class='"+nt.VIEW_BUTTON+" daily' data-toggle='calendar-view' data-option='daily'>Daily</button></li><li class='"+nt.VIEWS_ITEM+"'><button type='button' class='"+nt.VIEW_BUTTON+" weekly' data-toggle='calendar-view' data-option='weekly'>Weekly</button></li><li class='"+nt.VIEWS_ITEM+"'><button type='button' class='"+nt.VIEW_BUTTON+" monthly' data-toggle='calendar-view' data-option='monthly'>Monthly</button></li></ul></div>",CONTROL:"<button class='"+nt.CONTROLS_CONTAINER+"' type='submit' {direction}>{label}</button>",ADD_MENU:"<div class='"+nt.ADD_MENU_CONTAINER+"' id='addMenuComponent'><div class='"+nt.ADD_MENU_INNER+"'><div class='"+nt.ADD_MENU_BUTTONS_CONTAINER+"'><button class='"+nt.ADD_MENU_BUTTON+"' type='button' data-action='add-event'>Add Event</button><button class='"+nt.ADD_MENU_BUTTON+" cancel' data-action='cancel' type='button'>Cancel</button></div><span class='caret'></span></div></div>",EVENTS_CONTAINER:"<div class='"+nt.WEEK_EVENTS+"' data-row='{row}'></div>"},st={spring:{display_name:"Spring",months:[3,4,5,6]},summer:{display_name:"Summer",months:[7,8,9]},fall:{display_name:"Fall",months:[10,11]},winter:{display_name:"Winter",months:[12,1,2]}},ot=["January","February","March","April","May","June","July","August","September","October","November","December"],t=new function(){var D=this;D.now=new Date,D.selection=[],D.modal=null,D.editModal=null,D.events=[],D.eventInstances=[],D.viewOptions=["daily","weekly","monthly"];var a=moment(),s=moment(a).add(6,"days");D.settings={},D.init=function(t){D.el=this,D.settings=et.extend({month:D.now.getMonth()+1,year:D.now.getFullYear(),dayStyle:"short",cellMaxHeigh:150,respData:"data",id:"id",title:"title",startDate:"startDate",endDate:"endDate",startTime:"startTime",endTime:"endTime",creatRequest:null,editRequest:null,view:"monthly",hideViewOptions:!1},t);var e=et.extend(st,t?t.seasons:{});return D.settings.seasons=e,(D.settings.month<1||12<D.settings.month)&&(D.settings.month=1),n(),D};var n=function(){t(),D.modal=new CPEventFormModal("new-event"+D.now.getTime(),{url:D.settings.createUrl||D.settings.url||null,data:D.settings.data,headers:D.settings.headers,onSaved:Y,requestStruct:D.settings.creatRequest||null}),D.modal.render(),D.editModal=new CPEventFormModal("edit-event"+D.now.getTime(),{editting:!0,url:D.settings.editUrl||D.settings.url||null,deleteUrl:D.settings.deleteUrl||D.settings.url||null,data:D.settings.data,headers:D.settings.headers,onSaved:Y,onDelete:Y,requestStruct:D.settings.editRequest||null}),D.editModal.render()},t=function(){var t="";switch(D.settings.view){case"daily":t=E(u());break;case"weekly":t=e();break;case"monthly":t=E(u())}0<et(D.el).find(it.CONTAINER).length?et(D.el).find(it.CONTAINER).fadeOut(200,function(){et(D.el).html(""),et(t).hide().prependTo(et(D.el)).fadeIn(200,function(){Y()}).call(h)}):et(t).hide().prependTo(et(D.el)).fadeIn(200,function(){Y()}).call(h)},e=function(){return"<div class='"+nt.CONTAINER+"' id='"+it.CONTAINER_ID+"'>"+A("weekly")+"<table class='"+nt.CALENDAR+" {classnames} weekly'  cellspacing='0' cellpadding='0'><thead>"+o()+"</thead><tbody>"+l()+"</tbody></table>"+O()+"</div>"},o=function(){for(var t='<tr class="'+nt.MONTH_HEADING+'"><th colspan="2" style="width:initial; text-align: right;">Time</th>',e=a.get("time");e<=s.get("time");e+=864e5)t+='<th colspan="1" style="width:initial; text-align: center;">'+moment(e).format("ddd DD")+"</th>";return t+="</tr>"},l=function(){for(var t,e=[12,1,3,4,5,6,7,8,9,10,11,12,1,3,4,5,6,7,8,9,10,11],n="",i=0;i<e.length;i++)t=tt(e[i]),t+=11<i?" PM":" AM",n+='<tr class="'+nt.WEEK_ROW+' weekly"><td colspan="2" style="width:initial; text-align: right;">'+t+'</td><td colspan="1" style="width:initial; "></td><td colspan="1" style="width:initial; "></td><td colspan="1" style="width:initial; "></td><td colspan="1" style="width:initial; "></td><td colspan="1" style="width:initial; "></td><td colspan="1" style="width:initial; "></td><td colspan="1" style="width:initial; "></td></tr>';return n},A=function(t){var e=V(D.settings.month-1),n="";if(n+=" "+nt.MONTH_HEADER.replace("{month}",V(D.settings.month-1).toLowerCase())+" ",n+=" "+nt.SEASON_HEADER.replace("{season}",B()?B().name:"")+" ","weekly"==t){e=V(a.get("month"));n+=" "+nt.MONTH_HEADER.replace("{month}",V(a.get("month")-1).toLowerCase())+" ",e+=" "+tt(a.get("date"))+" - ",e+=s.get("month")!=a.get("month")?V(s.get("month"))+" "+tt(s.get("date")):tt(s.get("date"))}return"<div class='"+nt.HEADER+" "+n+"'><div class='"+nt.NAV_CONTROLS+"'>"+r("left")+r("right")+"</div><div class='"+nt.HEADER_CONTENT+"'><div class='"+nt.HEADER_OPTIONS_CONTAINER+"'><button class='"+nt.MONTH_NAME_BUTTON+"'>"+e+"<span class='caret'></span></button><div class='"+nt.HEADER_OPTIONS+"' id='headerOptionsComponent'><div class='"+nt.HEADER_OPTIONS_INNER+"'><div class='"+nt.HEADER_OPTIONS_BUTTONS_CONTAINER+"'><a class='"+nt.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='pdf'>Export to .pdf</a><a class='"+nt.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='docx'>Export to .docx</a></div><span class='caret'></span></div></div></div></div>"+d()+"</div>"},r=function(t){var e="right"==t?"&rarr;":"&larr;";return"<button class='"+nt.CONTROLS_CONTAINER+"' type='submit' "+t+">"+e+"</button>"},d=function(){return"<div class='"+nt.VIEWS_LIST_CONTAINER+"'><ul class='"+nt.VIEWS_LIST+"'><li class='"+nt.VIEWS_ITEM+"'><button type='button' class='"+nt.VIEW_BUTTON+" daily' data-toggle='calendar-view' data-option='daily'>Day</button></li><li class='"+nt.VIEWS_ITEM+"'><button type='button' class='"+nt.VIEW_BUTTON+" weekly' data-toggle='calendar-view' data-option='weekly'>Week</button></li><li class='"+nt.VIEWS_ITEM+"'><button type='button' class='"+nt.VIEW_BUTTON+" monthly' data-toggle='calendar-view' data-option='monthly'>Month</button></li></ul></div>"},O=function(){return"<div class='"+nt.ADD_MENU_CONTAINER+"' id='addMenuComponent'><div class='"+nt.ADD_MENU_INNER+"'><div class='"+nt.ADD_MENU_BUTTONS_CONTAINER+"'><button class='"+nt.ADD_MENU_BUTTON+"' type='button' data-action='add-event'>Add Event</button><button class='"+nt.ADD_MENU_BUTTON+" cancel' data-action='cancel' type='button'>Cancel</button></div><span class='caret'></span></div></div>"},c=function(){for(var t=0;t<D.eventInstances.length;t++){D.eventInstances[t].destroy()}D.eventInstances=[]},h=function(){var t=it.CONTAINER,e=it.ADD_MENU_BUTTON,n=it.EXPORT_BUTTON;v(),et(window).off("resize",v),et(window).on("resize",v),f(),et(window).off("resize",f),et(window).on("resize",f),et(window).off("resize",P),et(window).on("resize",P),et(t).find(e).off("click",I),et(t).find(e).on("click",I),et(t).find(n).off("click",J),et(t).find(n).on("click",J),N(),b(),M(),Z(),j()},E=function(t){for(var e=U(at.CONTAINER),n=U(at.MAIN),i=U(at.DAYS_HEADING),a=U(at.DAY_CELL),s=U(at.WEEK_ROW),o=U(at.EVENTS_CONTAINER),l=(D.settings.hideViewOptions||U(at.VIEWS),U(at.ADD_MENU),V(D.settings.month-1)),r=B(),d="",c="",h=0;h<t.length;h++){for(var E="",u=0;u<t[h].length;u++){var T="",_=t[h][u].toString(),v=t[h][u-1]?t[h][u-1].toString():"",f=a.replace("{content}",t[h][u]);if(_.length<1)T+=" "+nt.EMPTY_DAY+" ",0==u&&_.length<1&&(T+=" "+nt.EMPTY_DAY_BEGINNING+" "),v&&g()==v.trim()&&(T+=" "+nt.EMPTY_DAY_ENDING+" "),f=f.replace("{date}","");else{T+=" "+nt.DATE_DAY;var N=new Date(D.settings.month+"/"+t[h][u]+"/"+D.settings.year);f=f.replace("{date}",N.getTime())}E+=f=f.replace("{classnames}",T)}var p=U(s);p=p.replace("{row}",h+1),c+=o.replace("{row}",h+1),d+=p.replace("{content}",E)}var m="";return m+=" "+nt.MONTH_CALENDAR.replace("{month}",l.toLowerCase())+" ",m+=" "+nt.SEASON_CALENDAR.replace("{season}",r?r.name:"")+" ",n=(n=(n=n.replace("{content}",d)).replace("{heading}",i)).replace("{classnames}",m),e=(e=(e=(e=e.replace("{header}",A())).replace("{calendar}",n)).replace("{event-containers}",c)).replace("{add_menu}",O())},u=function(){var t=g(D.settings.month,D.settings.year),e=new Date(D.settings.year,D.settings.month-1,1).getDay();return W(T(e,t),7)},T=function(t,e){var n=[];for(i=0;i<35;i++)i>=t&&i-t<e?n.push(i-t+1):n.push("");return n},g=function(t,e){var n,i="number"==typeof t?t.toString():t;return-1!=["1","3","5","7","8","10","12"].indexOf(i)?n=31:-1!=["4","6","9","11","8"].indexOf(i)?n=30:2==t&&(n=_(e)?29:28),n},_=function(t){return t%4==0},v=function(){var t=it.DATE_CELL_CONTENT,e=et(it.CONTAINER+" "+it.CALENDAR+" "+it.WEEK_ROW+" "+it.DATE_CELL),n=et(e[0]).outerWidth()>D.settings.cellMaxHeigh?D.settings.cellMaxHeigh:et(e[0]).outerWidth();e.find(t).css({height:n+"px"}),k()},f=function(){for(var t=et(it.CONTAINER+" "+it.CALENDAR+" "+it.WEEK_ROW+" "+it.DATE_CELL),e=et(t[0]).outerWidth(),n=0,i=0;i<t.length;i++){var a=t.eq(i);if(a.hasClass(nt.EMPTY_DAY)){var s=n*e;s=s<=0?0:-s,a.css({backgroundPosition:s+"px 0px"}),n++}}},N=function(){var t=U(it.CONTROL_BUTTONS);et(t).off("click",p),et(t).on("click",p)},p=function(t){var e=t.target,n=et(e).attr("left"),i=et(e).attr("right"),a=U(D.settings),s=void 0!==n?"left":void 0;s=void 0!==i?"right":s,"monthly"==a.view&&m(s),"weekly"==a.view&&S(s),"daiky"==a.view&&m(s)},m=function(t){var e=U(D.settings);"left"==t?(e.year=e.month<=1?e.year-1:e.year,e.month=e.month<=1?e.month=12:e.month-1):"right"==t&&(e.year=12<=e.month?e.year+1:e.year,e.month=12<=e.month?e.month=1:e.month+1),D.settings=et.extend({},D.settings,e),n()},S=function(t){U(D.settings);"left"==t?a=moment(a).subtract(8,"day"):"right"==t&&(a=moment(s).add(1,"day")),s=moment(a).add(6,"day"),n()},I=function t(e){var n=it.ADD_MENU_BUTTON;switch(et(it.CONTAINER).find(n).off("click",t),et(e.currentTarget).attr("data-action")){case"add-event":R();break;case"cancel":C()}h()},R=function(){var t=0<D.selection.length?D.selection[0]:null,e=1<D.selection.length?D.selection[1]:t;if(null!=t){var n={startDate:new Date(t),endDate:new Date(e)};D.modal.show(n),C()}},C=function(){D.selection=[],M()},y=function(t){var e=new Date(t.startDate),n=new Date(t.endDate),i={title:t.title,startDate:e,endDate:n,startTime:t.startTime,endTime:t.endTime};D.editModal.show(i,t.id)},b=function(){var t=it.DATE_DAY;et(t).off("click",w),et(t).on("click",w)},w=function t(e){et(it.DATE_DAY).off("click",t);var n=e.currentTarget,i=et(n).attr("data-date"),a=0<D.selection.length?D.selection[0]:0,s=1<D.selection.length?D.selection[1]:a;null!=i&&(i=parseInt(i),a<1||0<a&&i<a?D.selection[0]=i:i==a&&s==a?D.selection=[]:i==a?D.selection=[a]:D.selection[1]=i),b(),M()},M=function(){var t=it.CALENDAR,e=it.DATE_DAY,n=nt.DATE_SELECTED,i=et(t).find(e),a=0<D.selection.length?D.selection[0]:0,s=1<D.selection.length?D.selection[1]:a;if(i&&0<i.length)for(var o=0;o<i.length;o++){var l=i.eq(o),r=et(l).attr("data-date");if(null!=r)a<=(r=parseInt(r))&&r<=s?et(l).hasClass(n)||et(l).addClass(n):et(l).hasClass(n)&&et(l).removeClass(n)}L()},L=function(){var t=it.CONTAINER,e=it.ADD_MENU_CONTAINER,n=it.DATE_SELECTED,i=nt.ADD_MENU_VISIBLE,a=et(t),s=a.find(n),o=a.find(e);s&&0<s.length?o.hasClass(i)||o.addClass(i):o.hasClass(i)&&o.removeClass(i),k()},k=function(){var t=it.ADD_MENU_CONTAINER,e=it.CONTAINER,n=nt.ADD_MENU_ABOVE,i=x(),a=et(e).find(t),s=F();if(null!=i&&null!=i){var o=i.offset(),l=o?o.left:0,r=o?o.top+i.outerHeight()-10:0;i.outerWidth()>a.outerWidth()?l+=(i.outerWidth()-a.outerWidth())/2:l-=(a.outerWidth()-i.outerWidth())/2,a.outerHeight()+r>s.height?(r=o?o.top-a.outerHeight()+10:0,a.hasClass(n)||a.addClass(n)):a.hasClass(n)&&a.removeClass(n),a.css({top:r,left:l})}},P=function(){for(var t,e,n,i,a,s,o=it.CONTAINER,l=it.CALENDAR,r=it.WEEK_EVENTS,d=it.WEEK_ROW,c=(nt.EVENTS_CONTAINER_READY,et(o).find(r)),h=et(l).position(),E=et(o).outerHeight(),u=0;u<c.length;u++){var T=(t=c.eq(u)).children("button.cp-ev-event");if(n=(e=et(l).find(d+'[data-row="'+t.attr("data-row")+'"]')).position(),i=e.outerWidth,a=e.outerHeight(),s=E-(h.top+n.top)-a+10,0<T.length)s+=T.first().outerHeight()*T.length;t.css({left:n.left,bottom:s,width:i})}H()},H=function(){for(var t=0;t<D.eventInstances.length;t++){D.eventInstances[t].reposition()}},W=function(t,e){for(var n=[],i=0;i<t.length;i+=e)n.push(t.slice(i,i+e));return n},U=function(t){return JSON.parse(JSON.stringify(t))},V=function(t){return null==ot[t]?"":ot[t]},B=function(){for(var t in D.settings.seasons){var e=D.settings.seasons[t];if(null!=e&&-1!=e.months.indexOf(D.settings.month))return{name:t,display_name:e.display_name}}return null},x=function(){var t=0<D.selection.length?D.selection[0]:null,e=1<D.selection.length?D.selection[1]:t,n=it.DATE_SELECTED;return e&&(e=et(it.CONTAINER).find(n).last()),e},F=function(){return{width:et(document).outerWidth(),height:et(document).outerHeight()}},Y=function(){i&&4!=i.readyState&&i.abort();var t=D.settings.list_url||D.settings.url||null;if(t)var e=et.extend({},D.settings.data,{month:D.settings.month,year:D.settings.year}),n=et.extend({},D.settings.headers),i=et.ajax({url:t,method:"GET",data:e,headers:n}).done(X).fail(q)},X=function(t){D.events=G(t),function(){c();for(var t,e,n,i=it.WEEK_ROW,a=it.WEEK_EVENTS,s=it.DATE_CELL,o=et(it.CALENDAR).find(i),l=0;l<D.events.length;l++)for(var r=D.events[l],d=0;d<o.length;d++)t=o.eq(d),$(t,r)&&(e=et(a+'[data-row="'+t.attr("data-row")+'"]'),(n=new CPEvent(r,e,t,s,{onClick:y})).render(),D.eventInstances.push(n));P()}()},q=function(t){if("abort"!=t.statusText){var e="Failed to load events.";e=t.message&&0<t.message.length?t.message:e}},G=function(t){if(null===D.settings.respData)return t;if("string"!=typeof D.settings.respData)return console.error(new Error("Data path invalid, please contact system's admin.")),t;var e=U(D.settings.respData);e=(e=e.trim()).split(".");for(var n=U(t),i=0;i<e.length;i++)n.hasOwnProperty(e[i])&&(n=n[e[i]]);if(n)for(i=0;i<n.length;i++)n[i]=z(n[i]);return n},z=function(t){return{id:K(t,D.settings.id),title:K(t,D.settings.title),startDate:K(t,D.settings.startDate),endDate:K(t,D.settings.endDate),startTime:K(t,D.settings.startTime),endTime:K(t,D.settings.endTime)}},K=function(t,e){if("string"!=typeof e)return console.error(new Error("Data path invalid, please contact system's admin.")),t;var n=U(e);n=(n=n.trim()).split(".");for(var i=U(t),a=!1,s=0;s<n.length;s++)i.hasOwnProperty(n[s])&&(i=i[n[s]],a=!0);return a?i:null},$=function(t,e){for(var n,i,a=it.DATE_CELL,s=t.find(a),o=!1,l=new Date(e.startDate),r=new Date(e.endDate),d=0;d<s.length;d++)if(i=s.eq(d),n=parseInt(i.attr("data-date")),l.getTime()==n||l.getTime()<=n&&r.getTime()>=n){o=!0;break}return o},J=function(t){t.preventDefault();var e=et(t.currentTarget),n=it.CONTAINER_ID;e.attr("data-format"),et("#"+n)},j=function(){et(it.VIEW_SELECTOR).off("click",Q),et(it.VIEW_SELECTOR).on("click",Q)},Q=function(t){var e=et(t.currentTarget).attr("data-option");-1==D.viewOptions.indexOf(e)&&(e="monthly"),D.settings.view!=e&&(D.settings=et.extend({},D.settings,{view:e}),setTimeout(n,200))},Z=function(){var t=it.VIEWS_LIST_CONTAINER,e=et(t).find("[data-option='"+D.settings.view+"']");0<e.length&&(e.hasClass(nt.ACTIVE)||(et(t).find("[data-toggle='calendar-view']").removeClass(nt.ACTIVE),e.addClass(nt.ACTIVE)))},tt=function(t){return"number"==typeof t&&(t=t.toString()),2<=t.trim().length?t:"0"+t}};et.fn.CalendarPlugin=t.init,et.fn.call=function(t,e,n){return t.apply(n||this,e),this}}(jQuery);var _createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CPEventFormModal=function(){function n(t,e){_classCallCheck(this,n),this.uniqueID=t,this.id=null,this.modal=null,this.PREFIX="cp-ef",this.options=$.extend({url:null,edit:!1,onWillShow:null,onShown:null,onWillHide:null,onHidden:null,onDelete:null},e),this.html=this.html.bind(this),this.render=this.render.bind(this),this.SELECTORS=this.SELECTORS.bind(this),this.CLASSNAMES=this.CLASSNAMES.bind(this),this.componentDidRender=this.componentDidRender.bind(this)}return _createClass(n,[{key:"SELECTORS",value:function(){return{BODY:"body",FORM:"."+this.PREFIX+"-form",FIELDSET:"fieldset",MODAL:"."+this.PREFIX+"-modal",BUTTON:"."+this.PREFIX+"-button",TITLE:'input[name="event-title"]',END_TIME:'input[name="end-time"]',END_DATE:'input[name="end-date"]',START_DATE:'input[name="start-date"]',START_TIME:'input[name="start-time"]',ERROR_CONTAINER:"."+this.PREFIX+"-error-container"}}},{key:"CLASSNAMES",value:function(){return{SHOW:"show",CANCEL:"cancel",SAVE:"save",DELETE:"delete"}}}]),_createClass(n,[{key:"componentDidRender",value:function(){this.modal=$("#"+this.uniqueID),this.listeners(),this.initializePickers()}},{key:"render",value:function(){var t=this.SELECTORS(),e=(t.MODAL,t.BODY),n=$("#"+this.uniqueID);0<n.length&&n.remove(),$(this.html()).attr("id",this.uniqueID).appendTo(e),this.componentDidRender()}},{key:"html",value:function(){return"<div class='"+this.PREFIX+"-modal'><div class='"+this.PREFIX+"-backdrop'>&nbsp;</div><div class='"+this.PREFIX+"-content'><div class='"+this.PREFIX+"-dialog'><form action='javascript:;' class='"+this.PREFIX+"-form' method='POST'><fieldset><p class='"+this.PREFIX+"-error "+this.PREFIX+"-error-container'></p><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><input type='text' name='event-title' class='"+this.PREFIX+"-title' placeholder='Event title...' /></div></div><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><label for='start-date'>Start Date</label><input type='text' name='start-date' placeholder='MM/DD/YYYY' autocomplete='off' /></div><div class='"+this.PREFIX+"-control'><label for='end-date'>End Date</label><input type='text' name='end-date' placeholder='MM/DD/YYYY' autocomplete='off' /></div></div><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><label for='start-time'>Start Time</label><input type='time' name='start-time' placeholder='hh:mm AM/PM' /></div><div class='"+this.PREFIX+"-control'><label for='end-time'>End Time</label><input type='time' name='end-time' placeholder='hh:mm AM/PM' /></div></div><div class='"+this.PREFIX+"-actions'>"+this.delete_button()+"<button type='button' class='"+this.PREFIX+"-button cancel'>Cancel</button><button type='submit' class='"+this.PREFIX+"-button save'>Save</button></div></fieldset></form></div></div></div>"}},{key:"listeners",value:function(){var t=this.SELECTORS(),e=t.BUTTON,n=t.FORM;this.modal.find(e).off("click",this.handle_button_click.bind(this)),this.modal.find(e).on("click",this.handle_button_click.bind(this)),this.modal.find(n).off("submit",this.handle_form_submit.bind(this)),this.modal.find(n).on("submit",this.handle_form_submit.bind(this)),this.modal.find(n).off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",this.handle_form_transition_end.bind(this)),this.modal.find(n).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",this.handle_form_transition_end.bind(this))}},{key:"initializePickers",value:function(){var t=this.SELECTORS(),e=t.START_DATE,n=t.END_DATE;this.modal.find(e).datepicker("destroy"),this.modal.find(e).datepicker(),this.modal.find(n).datepicker("destroy"),this.modal.find(n).datepicker()}},{key:"handle_button_click",value:function(t){var e=this.CLASSNAMES(),n=e.CANCEL,i=(e.SAVE,e.DELETE),a=$(t.currentTarget);a.hasClass(n)&&this.hide(),a.hasClass(i)&&this.confirm_delete()}},{key:"handle_form_submit",value:function(t){t.preventDefault(),this.validate()?this.show_validation_error():(this.hide_validation_error(),this.save())}},{key:"delete_button",value:function(){return this.options.editting?"<button type='button' class='"+this.PREFIX+"-button delete'>Delete</button>":""}},{key:"handle_form_transition_end",value:function(t){}},{key:"show",value:function(t,e){if(this.has_rendered()){this.reset(t),this.id=e||null;var n=this.CLASSNAMES().SHOW;this.modal.hasClass(n)||this.modal.addClass(n)}}},{key:"confirm_delete",value:function(){confirm("Are you sure you want to delete, this event?"),this.delete()}},{key:"hide",value:function(){if(this.has_rendered()){var t=this.CLASSNAMES().SHOW;this.modal.hasClass(t)&&this.modal.removeClass(t)}}},{key:"has_rendered",value:function(){return null!=this.modal&&null!=this.modal&&0<this.modal.length}},{key:"reset",value:function(t){var e=this.SELECTORS(),n=e.START_DATE,i=e.END_DATE,a=e.START_TIME,s=e.END_TIME,o=e.TITLE,l=t.startDate?this.format_date(t.startDate):"",r=t.endDate?this.format_date(t.endDate):"",d=t.startTime||"",c=t.endTime||"",h=t.title||"";this.modal.find(n).val(l),this.modal.find(i).val(r),this.modal.find(a).val(d),this.modal.find(s).val(c),this.modal.find(o).val(h),this.hide_validation_error()}},{key:"format_date",value:function(t){var e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return this.leading_zero(n)+"/"+this.leading_zero(i)+"/"+e}},{key:"leading_zero",value:function(t){return"string"!=typeof t&&"number"!=typeof t?"0":("number"==typeof t&&(t=t.toString()),1<t.length?t:"0"+t)}},{key:"validate",value:function(){if(!this.modal)return"An unknow error has occured.";var t=this.get_form_data();return!t.title||t.title.length<1?"Please enter and event title.":!t.startDate||t.startDate.length<1?"Please select a start date.":"Invalid Date"==new Date(t.startDate)?"Start date is not a valid date.":!t.endDate||t.endDate.length<1?"Please select an end date.":"Invalid Date"==new Date(t.endDate)?"End date is not a valid date.":!t.startTime||t.startTime.length<1?"Please specify a start time.":this.time_regex(t.startTime)?!t.endTime||t.endTime.length<1?"Please specify a end time.":!this.time_regex(t.endTime)&&"End time invalid. E.g hh:mm AM/PM.":"Start time invalid. E.g hh:mm AM/PM."}},{key:"show_validation_error",value:function(){var t=this.validate();if(t){var e=this.SELECTORS(),n=e.FORM,i=e.ERROR_CONTAINER,a=this.CLASSNAMES().SHOW,s=this.modal.find(n).find(i);!s||s.length<1||(s.text(t),s.hasClass(a)||s.addClass(a))}}},{key:"hide_validation_error",value:function(){var t=this.SELECTORS(),e=t.FORM,n=t.ERROR_CONTAINER,i=this.CLASSNAMES().SHOW,a=this.modal.find(e).find(n);!a||a.length<1||(a.text(""),a.hasClass(i)&&a.removeClass(i))}},{key:"disable",value:function(t){var e=this.SELECTORS(),n=e.FORM,i=e.FIELDSET,a=e.BUTTON;t=!!t,this.modal.find(n).find(i).attr("disabled",t),this.modal.find(n).find(a).attr("disabled",t)}},{key:"time_regex",value:function(t){"string"!=typeof t&&(t+="");return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t)}},{key:"get_form_data",value:function(){var t=this.SELECTORS(),e=t.START_DATE,n=t.END_DATE,i=t.START_TIME,a=t.END_TIME,s=t.TITLE;return{title:this.modal.find(s).val(),startDate:this.modal.find(e).val(),endDate:this.modal.find(n).val(),startTime:this.modal.find(i).val(),endTime:this.modal.find(a).val()}}},{key:"save",value:function(){if(null!=this.build_url()){var t=$.extend({},this.options.data,this.get_form_data());t=this.add_structs(t);var e=$.extend({},this.options.headers);this.disable(!0),$.ajax({url:this.options.url,data:t,headers:e,method:this.options.editting?"PUT":"POST"}).done(this.save_done.bind(this)).fail(this.save_failed.bind(this))}}},{key:"save_done",value:function(t){"function"==typeof this.options.onSaved&&this.options.onSaved();var e=this;setTimeout(function(){e.disable(!1),e.hide()},800)}},{key:"save_failed",value:function(t){this.disable(!1);var e="Failed to"+(this.options.editting?" save changes.":" save new event.");e=t.message&&0<t.message.length?t.message:e;alert(e)}},{key:"add_structs",value:function(t){if(this.options.requestStruct){var e=JSON.parse(JSON.stringify(this.options.requestStruct));for(var n in e)"string"==typeof e[n]&&void 0!==t[n]&&void 0===t[e[n]]&&(t[e[n]]=JSON.parse(JSON.stringify(t[n])),delete t[n])}return t}},{key:"delete",value:function(){if(null!=this.build_url("delete")){var t=$.extend({},this.options.data),e=$.extend({},this.options.headers);this.disable(!0),$.ajax({url:this.options.url,data:t,headers:e,method:"DELETE"}).done(this.delete_done.bind(this)).fail(this.delete_failed.bind(this))}}},{key:"delete_done",value:function(t){"function"==typeof this.options.onDelete&&this.options.onDelete();var e=this;setTimeout(function(){e.disable(!1),e.hide()},800)}},{key:"delete_failed",value:function(t){this.disable(!1);var e="Could not delete event, please try again in a moment.";e=t.message&&0<t.message.length?t.message:e;alert(e)}},{key:"build_url",value:function(t){if(!(t=!!t)&&null==this.options.url||t&&null==this.options.deleteUrl)return null;var e=t?JSON.parse(JSON.stringify(this.options.deleteUrl)):JSON.parse(JSON.stringify(this.options.url)),n=new RegExp(/^(:id)$/,"ig");return this.options.editting?n.test(e)?e=e.replace(n,this.id):this.options.data=$.extend({},this.options.data,{id:this.id}):e=e,e}}]),n}();_createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CPEvent=function(){function o(t,e,n,i,a){_classCallCheck(this,o);var s=new Date;this.PREFIX="cp-ev",this.uniqueID=this.PREFIX+s.getTime()+""+Math.ceil(100*Math.random()),this.container=e,this.week=n,this.cellSelector=i,this.event=null,this.data=t,this.start=this.options=$.extend({onClick:null},a),this.html=this.html.bind(this),this.render=this.render.bind(this),this.SELECTORS=this.SELECTORS.bind(this),this.CLASSNAMES=this.CLASSNAMES.bind(this),this.componentDidRender=this.componentDidRender.bind(this),this.reposition=this.reposition.bind(this),this.resize=this.resize.bind(this),this.set_start_end=this.set_start_end.bind(this),this.destroy=this.destroy.bind(this)}return _createClass(o,[{key:"SELECTORS",value:function(){return{BODY:"body",FORM:"."+this.PREFIX+"-form",FIELDSET:"fieldset",MODAL:"."+this.PREFIX+"-modal",BUTTON:"."+this.PREFIX+"-button",TITLE:'input[name="event-title"]',END_TIME:'input[name="end-time"]',END_DATE:'input[name="end-date"]',START_DATE:'input[name="start-date"]',START_TIME:'input[name="start-time"]',ERROR_CONTAINER:"."+this.PREFIX+"-error-container"}}},{key:"CLASSNAMES",value:function(){return{CONTAINER:this.PREFIX+"-event-container",EVENT:this.PREFIX+"-event",LABEL:this.PREFIX+"-event-label",START:"start",END:"end"}}}]),_createClass(o,[{key:"componentDidRender",value:function(){this.event=this.container.find("#"+this.uniqueID),this.listeners(),this.reposition()}},{key:"render",value:function(){this.container.append(this.html()),this.componentDidRender()}},{key:"html",value:function(){return"<button class='"+this.CLASSNAMES().EVENT+"' id='"+this.uniqueID+"' title='"+this.title()+"'><span class='"+this.CLASSNAMES().LABEL+"'>"+this.data.title+"</span></button>"}},{key:"title",value:function(){return this.data.title+" ("+this.data.startDate+" - "+this.data.endDate+")"}},{key:"listeners",value:function(){"function"==typeof this.options.onClick&&(this.event.off("click",this.handle_on_click.bind(this)),this.event.on("click",this.handle_on_click.bind(this)))}},{key:"handle_on_click",value:function(t){this.options.onClick(this.data)}},{key:"reposition",value:function(){this.set_start_end();var t=new Date(this.data.startDate),e=(new Date(this.data.endDate),this.start.offset().left-this.container.offset().left);t.getTime()==parseInt(this.start.attr("data-date"))&&(e+=15),this.event.css({marginLeft:e+"px"}),this.resize()}},{key:"resize",value:function(){var t=new Date(this.data.startDate),e=new Date(this.data.endDate),n=this.start.offset().left,i=this.end.offset().left+this.end.outerWidth();t.getTime()==parseInt(this.start.attr("data-date"))&&(n+=15,this.event.hasClass(this.CLASSNAMES().START)||this.event.addClass(this.CLASSNAMES().START)),e.getTime()==parseInt(this.end.attr("data-date"))&&(i-=15,this.event.hasClass(this.CLASSNAMES().END)||this.event.addClass(this.CLASSNAMES().END));var a=i-n;this.event.css({width:a+"px"})}},{key:"set_start_end",value:function(){for(var t=new Date(this.data.startDate),e=new Date(this.data.endDate),n=this.week.find(this.cellSelector),i=null,a=null,s=0;s<n.length;s++){var o=n.eq(s),l=parseInt(o.attr("data-date"));if(null==i&&(i=l>=t.getTime()&&l<=e.getTime()||l==t.getTime()?o:null),null==a&&(n.length-1!=s&&l!=e.getTime()||(a=o)),null!=i&&null!=a)break}this.start=i,this.end=a}},{key:"destroy",value:function(){this.event.remove(),this.event=null}}]),o}();