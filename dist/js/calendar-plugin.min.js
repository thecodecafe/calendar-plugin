!function(W){var B={LOADER_SHOW:"show-loader",CONTAINER:"cp-container",CALENDAR:"cp-calendar",MONTH_CALENDAR:"cp-calendar-{month}",SEASON_CALENDAR:"cp-calendar-{season}",HEADER:"cp-header",HEADER_CONTENT:"cp-header-content",HEADER_OPTIONS_CONTAINER:"cp-header-options-container",HEADER_OPTIONS:"cp-header-options",HEADER_OPTIONS_INNER:"cp-header-options-inner",HEADER_OPTIONS_BUTTONS_CONTAINER:"cp-header-options-buttons-container",HEADER_OPTIONS_BUTTON:"cp-header-options-button",HEADER_OPTIONS_ABOVE:"cp-header-options-above",HEADER_OPTIONS_VISIBLE:"cp-header-options-visible",MONTH_HEADER:"cp-header-{month}",SEASON_HEADER:"cp-header-{season}",DATE_CELL:"cp-date",DATE_DAY:"cp-day",DATE_SELECTED:"cp-date-selected",DATE_CELL_CONTENT:"cp-date-content",WEEK_ROW:"cp-week",WEEK_EVENTS:"cp-week-events",MONTH_HEADING:"cp-month-heading",MONTH_CELL:"cp-month",CONTROLS_CONTAINER:"cp-control-container",MONTH_NAME_BUTTON:"cp-month-name",EMPTY_DAY:"cp-empty-day",EMPTY_DAY_BEGINNING:"cp-empty-day-beginning",EMPTY_DAY_ENDING:"cp-empty-day-ending",ADD_MENU_CONTAINER:"cp-add-menu",ADD_MENU_INNER:"cp-add-menu-inner",ADD_MENU_BUTTONS_CONTAINER:"cp-add-menu-buttons-container",ADD_MENU_BUTTON:"cp-add-menu-button",ADD_MENU_ABOVE:"cp-add-menu-above",ADD_MENU_VISIBLE:"cp-add-menu-visible",EVENTS_CONTAINER_READY:"ready"},x={BODY:"body",CONTAINER:".cp-container",CONTAINER_ID:"cp-container-id",CALENDAR:".cp-calendar",HEADER:".cp-header",HEADER_CONTENT:".cp-header-content",HEADER_OPTIONS_CONTAINER:".cp-header-options-container",HEADER_OPTIONS:".cp-header-options",HEADER_OPTIONS_INNER:".cp-header-options-inner",HEADER_OPTIONS_BUTTONS_CONTAINER:".cp-header-options-buttons-container",HEADER_OPTIONS_BUTTON:".cp-header-options-button",HEADER_OPTIONS_ABOVE:".cp-header-options-above",HEADER_OPTIONS_VISIBLE:".cp-header-options-visible",DATE_CELL:".cp-date",DATE_DAY:".cp-day",DATE_SELECTED:".cp-date-selected",DATE_CELL_CONTENT:".cp-date-content",WEEK_ROW:".cp-week",WEEK_EVENTS:".cp-week-events",MONTH_HEADING:".cp-month-heading",MONTH_CELL:".cp-month",CONTROLS_CONTAINER:".cp-control-container",CONTROL_BUTTONS:".cp-control-container > button",MONTH_NAME_BUTTON:".cp-month-name",EMPTY_DAY:".cp-empty-day",EMPTY_DAY_BEGINNING:".cp-empty-day-beginning",EMPTY_DAY_ENDING:".cp-empty-day-ending",ADD_MENU_CONTAINER:".cp-add-menu",ADD_MENU_INNER:".cp-add-menu-inner",ADD_MENU_BUTTON:".cp-add-menu-button",ADD_MENU_BUTTONS_CONTAINER:".cp-add-menu-buttons-container",EVENT_FORM_MODAL:".cp-ef-modal",EXPORT_BUTTON:'[data-export="calendar"]'},X={CONTAINER:"<div class='"+B.CONTAINER+"' id='"+x.CONTAINER_ID+"'>{header}{calendar}{event-containers}{add_menu}</div>",MAIN:"<table class='"+B.CALENDAR+" {classnames}'  cellspacing='0' cellpadding='0'><thead>{heading}</thead><tbody>{content}</tbody></table>",DAYS_HEADING:"<tr class='"+B.MONTH_HEADING+"'> <th>Sun</th> <th>Mon</th> <th>Tue</th> <th>Wed</th> <th>Thur</th> <th>Fri</th> <th>Sat</th> </tr>",WEEK_ROW:"<tr class='"+B.WEEK_ROW+"' data-row='{row}'>{content}</tr>",DAY_CELL:"<td class='"+B.DATE_CELL+" {classnames}' data-date='{date}'><div class='"+B.DATE_CELL_CONTENT+"'>{content}</div></td>",HEADER:"<div class='"+B.HEADER+" {classnames}'>{left-control}<div class='"+B.HEADER_CONTENT+"'><div class='"+B.HEADER_OPTIONS_CONTAINER+"'><button class='"+B.MONTH_NAME_BUTTON+"'>{month}<span class='caret'></span></button><div class='"+B.HEADER_OPTIONS+"' id='headerOptionsComponent'><div class='"+B.HEADER_OPTIONS_INNER+"'><div class='"+B.HEADER_OPTIONS_BUTTONS_CONTAINER+"'><a class='"+B.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='pdf'>Export to .pdf</a><a class='"+B.HEADER_OPTIONS_BUTTON+"' href='javascript:;' data-export='calendar' data-format='docx'>Export to .docx</a></div><span class='caret'></span></div></div></div></div>{right-control}</div>",CONTROL:"<div class='"+B.CONTROLS_CONTAINER+" {position}'><button class='' type='submit' {direction}>{label}</button></div>",ADD_MENU:"<div class='"+B.ADD_MENU_CONTAINER+"' id='addMenuComponent'><div class='"+B.ADD_MENU_INNER+"'><div class='"+B.ADD_MENU_BUTTONS_CONTAINER+"'><button class='"+B.ADD_MENU_BUTTON+"' type='button' data-action='add-event'>Add Event</button><button class='"+B.ADD_MENU_BUTTON+" cancel' data-action='cancel' type='button'>Cancel</button></div><span class='caret'></span></div></div>",EVENTS_CONTAINER:"<div class='"+B.WEEK_EVENTS+"' data-row='{row}'></div>"},V={spring:{display_name:"Spring",months:[3,4,5,6]},summer:{display_name:"Summer",months:[7,8,9]},fall:{display_name:"Fall",months:[10,11]},winter:{display_name:"Winter",months:[12,1,2]}},q=["January","February","March","April","May","June","July","August","September","October","November","December"],t=new function(){var S=this;S.moment=new moment,S.now=new Date,S.selection=[],S.modal=null,S.editModal=null,S.events=[],S.eventInstances=[],S.settings={},S.init=function(t){S.el=this,S.settings=W.extend({month:S.now.getMonth()+1,year:S.now.getFullYear(),dayStyle:"short",cellMaxHeigh:150,respData:"data",id:"id",title:"title",startDate:"startDate",endDate:"endDate",startTime:"startTime",endTime:"endTime",creatRequest:null,editRequest:null},t);var e=W.extend(V,t?t.seasons:{});return S.settings.seasons=e,(S.settings.month<1||12<S.settings.month)&&(S.settings.month=1),s(),S};var s=function(){t(),S.modal=new CPEventFormModal("new-event"+S.now.getTime(),{url:S.settings.createUrl||S.settings.url||null,data:S.settings.data,headers:S.settings.headers,onSaved:L,requestStruct:S.settings.creatRequest||null}),S.modal.render(),S.editModal=new CPEventFormModal("edit-event"+S.now.getTime(),{editting:!0,url:S.settings.editUrl||S.settings.url||null,deleteUrl:S.settings.deleteUrl||S.settings.url||null,data:S.settings.data,headers:S.settings.headers,onSaved:L,onDelete:L,requestStruct:S.settings.editRequest||null}),S.editModal.render()},t=function(){0<W(S.el).find(x.CONTAINER).length?W(S.el).find(x.CONTAINER).fadeOut(200,function(){W(S.el).html(""),W(e(n())).hide().prependTo(W(S.el)).fadeIn(200,function(){L()}).call(a)}):W(e(n())).hide().prependTo(W(S.el)).fadeIn(200,function(){L()}).call(a)},h=function(){for(var t=0;t<S.eventInstances.length;t++){S.eventInstances[t].destroy()}S.eventInstances=[]},a=function(){var t=x.CONTAINER,e=x.ADD_MENU_BUTTON,n=x.EXPORT_BUTTON;l(),W(window).off("resize",l),W(window).on("resize",l),d(),W(window).off("resize",d),W(window).on("resize",d),W(window).off("resize",A),W(window).on("resize",A),W(t).find(e).off("click",u),W(t).find(e).on("click",u),W(t).find(n).off("click",Y),W(t).find(n).on("click",Y),c(),_(),v()},e=function(t){for(var e=I(X.CONTAINER),n=I(X.HEADER),i=I(X.MAIN),a=I(X.DAYS_HEADING),s=I(X.DAY_CELL),r=I(X.WEEK_ROW),o=I(X.EVENTS_CONTAINER),l=I(X.CONTROL),d=I(X.CONTROL),h=I(X.ADD_MENU),c=y(S.settings.month-1),E=b(),u="",f="",T=0;T<t.length;T++){for(var p="",_=0;_<t[T].length;_++){var m="",v=t[T][_].toString(),N=t[T][_-1]?t[T][_-1].toString():"",D=s.replace("{content}",t[T][_]);if(v.length<1)m+=" "+B.EMPTY_DAY+" ",0==_&&v.length<1&&(m+=" "+B.EMPTY_DAY_BEGINNING+" "),N&&C()==N.trim()&&(m+=" "+B.EMPTY_DAY_ENDING+" "),D=D.replace("{date}","");else{m+=" "+B.DATE_DAY;var A=new Date(S.settings.month+"/"+t[T][_]+"/"+S.settings.year);D=D.replace("{date}",A.getTime())}p+=D=D.replace("{classnames}",m)}var O=I(r);O=O.replace("{row}",T+1),f+=o.replace("{row}",T+1),u+=O.replace("{content}",p)}var R="";R+=" "+B.MONTH_CALENDAR.replace("{month}",c.toLowerCase())+" ",R+=" "+B.SEASON_CALENDAR.replace("{season}",E?E.name:"")+" ",i=(i=(i=i.replace("{content}",u)).replace("{heading}",a)).replace("{classnames}",R),l=(l=(l=l.replace("{label}","&larr;")).replace("{position}","")).replace("{direction}","left"),d=(d=(d=d.replace("{label}","&rarr;")).replace("{position}","right")).replace("{direction}","right");var g="";return g+=" "+B.MONTH_HEADER.replace("{month}",c.toLowerCase())+" ",g+=" "+B.SEASON_HEADER.replace("{season}",E?E.name:"")+" ",n=(n=(n=(n=n.replace("{left-control}",l)).replace("{right-control}",d)).replace("{month}",c+" "+S.settings.year)).replace("{classnames}",g),e=(e=(e=(e=e.replace("{header}",n)).replace("{calendar}",i)).replace("{event-containers}",f)).replace("{add_menu}",h)},n=function(){var t=C(S.settings.month,S.settings.year),e=new Date(S.settings.year,S.settings.month-1,1).getDay();return R(r(e,t),7)},r=function(t,e){var n=[];for(i=0;i<35;i++)i>=t&&i-t<e?n.push(i-t+1):n.push("");return n},C=function(t,e){var n,i="number"==typeof t?t.toString():t;return-1!=["1","3","5","7","8","10","12"].indexOf(i)?n=31:-1!=["4","6","9","11","8"].indexOf(i)?n=30:2==t&&(n=o(e)?29:28),n},o=function(t){return t%4==0},l=function(){var t=x.DATE_CELL_CONTENT,e=W(x.CONTAINER+" "+x.CALENDAR+" "+x.WEEK_ROW+" "+x.DATE_CELL),n=W(e[0]).outerWidth()>S.settings.cellMaxHeigh?S.settings.cellMaxHeigh:W(e[0]).outerWidth();e.find(t).css({height:n+"px"}),D()},d=function(){for(var t=W(x.CONTAINER+" "+x.CALENDAR+" "+x.WEEK_ROW+" "+x.DATE_CELL),e=W(t[0]).outerWidth(),n=0,i=0;i<t.length;i++){var a=t.eq(i);if(a.hasClass(B.EMPTY_DAY)){var s=n*e;s=s<=0?0:-s,a.css({backgroundPosition:s+"px 0px"}),n++}}},c=function(){var t=I(x.CONTROL_BUTTONS);W(t).off("click",E),W(t).on("click",E)},E=function(t){var e=t.target,n=W(e).attr("left"),i=W(e).attr("right"),a=I(S.settings);null!=n?(a.year=a.month<=1?a.year-1:a.year,a.month=a.month<=1?a.month=12:a.month-1):null!=i&&(a.year=12<=a.month?a.year+1:a.year,a.month=12<=a.month?a.month=1:a.month+1),S.settings=W.extend(S.settings,a),s()},u=function t(e){var n=x.ADD_MENU_BUTTON;switch(W(x.CONTAINER).find(n).off("click",t),W(e.currentTarget).attr("data-action")){case"add-event":f();break;case"cancel":T()}a()},f=function(){var t=0<S.selection.length?S.selection[0]:null,e=1<S.selection.length?S.selection[1]:t;if(null!=t){var n={startDate:new Date(t),endDate:new Date(e)};S.modal.show(n),T()}},T=function(){S.selection=[],v()},p=function(t){var e=new Date(t.startDate),n=new Date(t.endDate),i={title:t.title,startDate:e,endDate:n,startTime:t.startTime,endTime:t.endTime};S.editModal.show(i,t.id)},_=function(){var t=x.DATE_DAY;W(t).off("click",m),W(t).on("click",m)},m=function t(e){W(x.DATE_DAY).off("click",t);var n=e.currentTarget,i=W(n).attr("data-date"),a=0<S.selection.length?S.selection[0]:0,s=1<S.selection.length?S.selection[1]:a;null!=i&&(i=parseInt(i),a<1||0<a&&i<a?S.selection[0]=i:i==a&&s==a?S.selection=[]:i==a?S.selection=[a]:S.selection[1]=i),_(),v()},v=function(){var t=x.CALENDAR,e=x.DATE_DAY,n=B.DATE_SELECTED,i=W(t).find(e),a=0<S.selection.length?S.selection[0]:0,s=1<S.selection.length?S.selection[1]:a;if(i&&0<i.length)for(var r=0;r<i.length;r++){var o=i.eq(r),l=W(o).attr("data-date");if(null!=l)a<=(l=parseInt(l))&&l<=s?W(o).hasClass(n)||W(o).addClass(n):W(o).hasClass(n)&&W(o).removeClass(n)}N()},N=function(){var t=x.CONTAINER,e=x.ADD_MENU_CONTAINER,n=x.DATE_SELECTED,i=B.ADD_MENU_VISIBLE,a=W(t),s=a.find(n),r=a.find(e);s&&0<s.length?r.hasClass(i)||r.addClass(i):r.hasClass(i)&&r.removeClass(i),D()},D=function(){var t=x.ADD_MENU_CONTAINER,e=x.CONTAINER,n=B.ADD_MENU_ABOVE,i=g(),a=W(e).find(t),s=M();if(null!=i&&null!=i){var r=i.offset(),o=r?r.left:0,l=r?r.top+i.outerHeight()-10:0;i.outerWidth()>a.outerWidth()?o+=(i.outerWidth()-a.outerWidth())/2:o-=(a.outerWidth()-i.outerWidth())/2,a.outerHeight()+l>s.height?(l=r?r.top-a.outerHeight()+10:0,a.hasClass(n)||a.addClass(n)):a.hasClass(n)&&a.removeClass(n),a.css({top:l,left:o})}},A=function(){for(var t,e,n,i,a,s,r=x.CONTAINER,o=x.CALENDAR,l=x.WEEK_EVENTS,d=x.WEEK_ROW,h=(B.EVENTS_CONTAINER_READY,W(r).find(l)),c=W(o).position(),E=W(r).outerHeight(),u=0;u<h.length;u++){var f=(t=h.eq(u)).children("button.cp-ev-event");if(n=(e=W(o).find(d+'[data-row="'+t.attr("data-row")+'"]')).position(),i=e.outerWidth,a=e.outerHeight(),s=E-(c.top+n.top)-a+10,0<f.length)s+=f.first().outerHeight()*f.length;t.css({left:n.left,bottom:s,width:i})}O()},O=function(){for(var t=0;t<S.eventInstances.length;t++){S.eventInstances[t].reposition()}},R=function(t,e){for(var n=[],i=0;i<t.length;i+=e)n.push(t.slice(i,i+e));return n},I=function(t){return JSON.parse(JSON.stringify(t))},y=function(t){return null==q[t]?"":q[t]},b=function(){for(var t in S.settings.seasons){var e=S.settings.seasons[t];if(null!=e&&-1!=e.months.indexOf(S.settings.month))return{name:t,display_name:e.display_name}}return null},g=function(){var t=0<S.selection.length?S.selection[0]:null,e=1<S.selection.length?S.selection[1]:t,n=x.DATE_SELECTED;return e&&(e=W(x.CONTAINER).find(n).last()),e},M=function(){return{width:W(document).outerWidth(),height:W(document).outerHeight()}},L=function(){i&&4!=i.readyState&&i.abort();var t=S.settings.list_url||S.settings.url||null;if(t)var e=W.extend({},S.settings.data,{month:S.settings.month,year:S.settings.year}),n=W.extend({},S.settings.headers),i=W.ajax({url:t,method:"GET",data:e,headers:n}).done(k).fail(P)},k=function(t){S.events=w(t),function(){h();for(var t,e,n,i=x.WEEK_ROW,a=x.WEEK_EVENTS,s=x.DATE_CELL,r=W(x.CALENDAR).find(i),o=0;o<S.events.length;o++)for(var l=S.events[o],d=0;d<r.length;d++)t=r.eq(d),F(t,l)&&(e=W(a+'[data-row="'+t.attr("data-row")+'"]'),(n=new CPEvent(l,e,t,s,{onClick:p})).render(),S.eventInstances.push(n));A()}()},P=function(t){if("abort"!=t.statusText){var e="Failed to load events.";e=t.message&&0<t.message.length?t.message:e}},w=function(t){if(null===S.settings.respData)return t;if("string"!=typeof S.settings.respData)return console.error(new Error("Data path invalid, please contact system's admin.")),t;var e=I(S.settings.respData);e=(e=e.trim()).split(".");for(var n=I(t),i=0;i<e.length;i++)n.hasOwnProperty(e[i])&&(n=n[e[i]]);if(n)for(i=0;i<n.length;i++)n[i]=H(n[i]);return n},H=function(t){return{id:U(t,S.settings.id),title:U(t,S.settings.title),startDate:U(t,S.settings.startDate),endDate:U(t,S.settings.endDate),startTime:U(t,S.settings.startTime),endTime:U(t,S.settings.endTime)}},U=function(t,e){if("string"!=typeof e)return console.error(new Error("Data path invalid, please contact system's admin.")),t;var n=I(e);n=(n=n.trim()).split(".");for(var i=I(t),a=!1,s=0;s<n.length;s++)i.hasOwnProperty(n[s])&&(i=i[n[s]],a=!0);return a?i:null},F=function(t,e){for(var n,i,a=x.DATE_CELL,s=t.find(a),r=!1,o=new Date(e.startDate),l=new Date(e.endDate),d=0;d<s.length;d++)if(i=s.eq(d),n=parseInt(i.attr("data-date")),o.getTime()==n||o.getTime()<=n&&l.getTime()>=n){r=!0;break}return r},Y=function(t){t.preventDefault();var e=W(t.currentTarget),n=x.CONTAINER_ID,i=e.attr("data-format"),a=W("#"+n);"pdf"==i&&html2canvas(a,{onrendered:function(t){var e=t.toDataURL("image/png"),n=new jsPDF("p","mm");n.addImage(e,"PNG",10,10),n.save("sample-file.pdf")}})}};W.fn.CalendarPlugin=t.init,W.fn.call=function(t,e,n){return t.apply(n||this,e),this}}(jQuery);var _createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CPEventFormModal=function(){function n(t,e){_classCallCheck(this,n),this.uniqueID=t,this.id=null,this.modal=null,this.PREFIX="cp-ef",this.options=$.extend({url:null,edit:!1,onWillShow:null,onShown:null,onWillHide:null,onHidden:null,onDelete:null},e),this.html=this.html.bind(this),this.render=this.render.bind(this),this.SELECTORS=this.SELECTORS.bind(this),this.CLASSNAMES=this.CLASSNAMES.bind(this),this.componentDidRender=this.componentDidRender.bind(this)}return _createClass(n,[{key:"SELECTORS",value:function(){return{BODY:"body",FORM:"."+this.PREFIX+"-form",FIELDSET:"fieldset",MODAL:"."+this.PREFIX+"-modal",BUTTON:"."+this.PREFIX+"-button",TITLE:'input[name="event-title"]',END_TIME:'input[name="end-time"]',END_DATE:'input[name="end-date"]',START_DATE:'input[name="start-date"]',START_TIME:'input[name="start-time"]',ERROR_CONTAINER:"."+this.PREFIX+"-error-container"}}},{key:"CLASSNAMES",value:function(){return{SHOW:"show",CANCEL:"cancel",SAVE:"save",DELETE:"delete"}}}]),_createClass(n,[{key:"componentDidRender",value:function(){this.modal=$("#"+this.uniqueID),this.listeners(),this.initializePickers()}},{key:"render",value:function(){var t=this.SELECTORS(),e=(t.MODAL,t.BODY),n=$("#"+this.uniqueID);0<n.length&&n.remove(),$(this.html()).attr("id",this.uniqueID).appendTo(e),this.componentDidRender()}},{key:"html",value:function(){return"<div class='"+this.PREFIX+"-modal'><div class='"+this.PREFIX+"-backdrop'>&nbsp;</div><div class='"+this.PREFIX+"-content'><div class='"+this.PREFIX+"-dialog'><form action='javascript:;' class='"+this.PREFIX+"-form' method='POST'><fieldset><p class='"+this.PREFIX+"-error "+this.PREFIX+"-error-container'></p><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><input type='text' name='event-title' class='"+this.PREFIX+"-title' placeholder='Event title...' /></div></div><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><label for='start-date'>Start Date</label><input type='text' name='start-date' placeholder='MM/DD/YYYY' /></div><div class='"+this.PREFIX+"-control'><label for='end-date'>End Date</label><input type='text' name='end-date' placeholder='MM/DD/YYYY' /></div></div><div class='"+this.PREFIX+"-group'><div class='"+this.PREFIX+"-control'><label for='start-time'>Start Time</label><input type='time' name='start-time' placeholder='hh:mm AM/PM' /></div><div class='"+this.PREFIX+"-control'><label for='end-time'>End Time</label><input type='time' name='end-time' placeholder='hh:mm AM/PM' /></div></div><div class='"+this.PREFIX+"-actions'>"+this.delete_button()+"<button type='button' class='"+this.PREFIX+"-button cancel'>Cancel</button><button type='submit' class='"+this.PREFIX+"-button save'>Save</button></div></fieldset></form></div></div></div>"}},{key:"listeners",value:function(){var t=this.SELECTORS(),e=t.BUTTON,n=t.FORM;this.modal.find(e).off("click",this.handle_button_click.bind(this)),this.modal.find(e).on("click",this.handle_button_click.bind(this)),this.modal.find(n).off("submit",this.handle_form_submit.bind(this)),this.modal.find(n).on("submit",this.handle_form_submit.bind(this)),this.modal.find(n).off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",this.handle_form_transition_end.bind(this)),this.modal.find(n).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",this.handle_form_transition_end.bind(this))}},{key:"initializePickers",value:function(){var t=this.SELECTORS(),e=t.START_DATE,n=t.END_DATE;this.modal.find(e).datepicker("destroy"),this.modal.find(e).datepicker(),this.modal.find(n).datepicker("destroy"),this.modal.find(n).datepicker()}},{key:"handle_button_click",value:function(t){var e=this.CLASSNAMES(),n=e.CANCEL,i=(e.SAVE,e.DELETE),a=$(t.currentTarget);a.hasClass(n)&&this.hide(),a.hasClass(i)&&this.confirm_delete()}},{key:"handle_form_submit",value:function(t){t.preventDefault(),this.validate()?this.show_validation_error():(this.hide_validation_error(),this.save())}},{key:"delete_button",value:function(){return this.options.editting?"<button type='button' class='"+this.PREFIX+"-button delete'>Delete</button>":""}},{key:"handle_form_transition_end",value:function(t){}},{key:"show",value:function(t,e){if(this.has_rendered()){this.reset(t),this.id=e||null;var n=this.CLASSNAMES().SHOW;this.modal.hasClass(n)||this.modal.addClass(n)}}},{key:"confirm_delete",value:function(){confirm("Are you sure you want to delete, this event?"),this.delete()}},{key:"hide",value:function(){if(this.has_rendered()){var t=this.CLASSNAMES().SHOW;this.modal.hasClass(t)&&this.modal.removeClass(t)}}},{key:"has_rendered",value:function(){return null!=this.modal&&null!=this.modal&&0<this.modal.length}},{key:"reset",value:function(t){var e=this.SELECTORS(),n=e.START_DATE,i=e.END_DATE,a=e.START_TIME,s=e.END_TIME,r=e.TITLE,o=t.startDate?this.format_date(t.startDate):"",l=t.endDate?this.format_date(t.endDate):"",d=t.startTime||"",h=t.endTime||"",c=t.title||"";this.modal.find(n).val(o),this.modal.find(i).val(l),this.modal.find(a).val(d),this.modal.find(s).val(h),this.modal.find(r).val(c),this.hide_validation_error()}},{key:"format_date",value:function(t){var e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return this.leading_zero(n)+"/"+this.leading_zero(i)+"/"+e}},{key:"leading_zero",value:function(t){return"string"!=typeof t&&"number"!=typeof t?"0":("number"==typeof t&&(t=t.toString()),1<t.length?t:"0"+t)}},{key:"validate",value:function(){if(!this.modal)return"An unknow error has occured.";var t=this.get_form_data();return!t.title||t.title.length<1?"Please enter and event title.":!t.startDate||t.startDate.length<1?"Please select a start date.":"Invalid Date"==new Date(t.startDate)?"Start date is not a valid date.":!t.endDate||t.endDate.length<1?"Please select an end date.":"Invalid Date"==new Date(t.endDate)?"End date is not a valid date.":!t.startTime||t.startTime.length<1?"Please specify a start time.":this.time_regex(t.startTime)?!t.endTime||t.endTime.length<1?"Please specify a end time.":!this.time_regex(t.endTime)&&"End time invalid. E.g hh:mm AM/PM.":"Start time invalid. E.g hh:mm AM/PM."}},{key:"show_validation_error",value:function(){var t=this.validate();if(t){var e=this.SELECTORS(),n=e.FORM,i=e.ERROR_CONTAINER,a=this.CLASSNAMES().SHOW,s=this.modal.find(n).find(i);!s||s.length<1||(s.text(t),s.hasClass(a)||s.addClass(a))}}},{key:"hide_validation_error",value:function(){var t=this.SELECTORS(),e=t.FORM,n=t.ERROR_CONTAINER,i=this.CLASSNAMES().SHOW,a=this.modal.find(e).find(n);!a||a.length<1||(a.text(""),a.hasClass(i)&&a.removeClass(i))}},{key:"disable",value:function(t){var e=this.SELECTORS(),n=e.FORM,i=e.FIELDSET,a=e.BUTTON;t=!!t,this.modal.find(n).find(i).attr("disabled",t),this.modal.find(n).find(a).attr("disabled",t)}},{key:"time_regex",value:function(t){"string"!=typeof t&&(t+="");return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t)}},{key:"get_form_data",value:function(){var t=this.SELECTORS(),e=t.START_DATE,n=t.END_DATE,i=t.START_TIME,a=t.END_TIME,s=t.TITLE;return{title:this.modal.find(s).val(),startDate:this.modal.find(e).val(),endDate:this.modal.find(n).val(),startTime:this.modal.find(i).val(),endTime:this.modal.find(a).val()}}},{key:"save",value:function(){if(null!=this.build_url()){var t=$.extend({},this.options.data,this.get_form_data());t=this.add_structs(t);var e=$.extend({},this.options.headers);this.disable(!0),$.ajax({url:this.options.url,data:t,headers:e,method:this.options.editting?"PUT":"POST"}).done(this.save_done.bind(this)).fail(this.save_failed.bind(this))}}},{key:"save_done",value:function(t){"function"==typeof this.options.onSaved&&this.options.onSaved();var e=this;setTimeout(function(){e.disable(!1),e.hide()},800)}},{key:"save_failed",value:function(t){this.disable(!1);var e="Failed to"+(this.options.editting?" save changes.":" save new event.");e=t.message&&0<t.message.length?t.message:e;alert(e)}},{key:"add_structs",value:function(t){if(this.options.requestStruct){var e=JSON.parse(JSON.stringify(this.options.requestStruct));for(var n in e)"string"==typeof e[n]&&void 0!==t[n]&&void 0===t[e[n]]&&(t[e[n]]=JSON.parse(JSON.stringify(t[n])),delete t[n])}return t}},{key:"delete",value:function(){if(null!=this.build_url("delete")){var t=$.extend({},this.options.data),e=$.extend({},this.options.headers);this.disable(!0),$.ajax({url:this.options.url,data:t,headers:e,method:"DELETE"}).done(this.delete_done.bind(this)).fail(this.delete_failed.bind(this))}}},{key:"delete_done",value:function(t){"function"==typeof this.options.onDelete&&this.options.onDelete();var e=this;setTimeout(function(){e.disable(!1),e.hide()},800)}},{key:"delete_failed",value:function(t){this.disable(!1);var e="Could not delete event, please try again in a moment.";e=t.message&&0<t.message.length?t.message:e;alert(e)}},{key:"build_url",value:function(t){if(!(t=!!t)&&null==this.options.url||t&&null==this.options.deleteUrl)return null;var e=t?JSON.parse(JSON.stringify(this.options.deleteUrl)):JSON.parse(JSON.stringify(this.options.url)),n=new RegExp(/^(:id)$/,"ig");return this.options.editting?n.test(e)?e=e.replace(n,this.id):this.options.data=$.extend({},this.options.data,{id:this.id}):e=e,e}}]),n}();_createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CPEvent=function(){function r(t,e,n,i,a){_classCallCheck(this,r);var s=new Date;this.PREFIX="cp-ev",this.uniqueID=this.PREFIX+s.getTime()+""+Math.ceil(100*Math.random()),this.container=e,this.week=n,this.cellSelector=i,this.event=null,this.data=t,this.start=this.options=$.extend({onClick:null},a),this.html=this.html.bind(this),this.render=this.render.bind(this),this.SELECTORS=this.SELECTORS.bind(this),this.CLASSNAMES=this.CLASSNAMES.bind(this),this.componentDidRender=this.componentDidRender.bind(this),this.reposition=this.reposition.bind(this),this.resize=this.resize.bind(this),this.set_start_end=this.set_start_end.bind(this),this.destroy=this.destroy.bind(this)}return _createClass(r,[{key:"SELECTORS",value:function(){return{BODY:"body",FORM:"."+this.PREFIX+"-form",FIELDSET:"fieldset",MODAL:"."+this.PREFIX+"-modal",BUTTON:"."+this.PREFIX+"-button",TITLE:'input[name="event-title"]',END_TIME:'input[name="end-time"]',END_DATE:'input[name="end-date"]',START_DATE:'input[name="start-date"]',START_TIME:'input[name="start-time"]',ERROR_CONTAINER:"."+this.PREFIX+"-error-container"}}},{key:"CLASSNAMES",value:function(){return{CONTAINER:this.PREFIX+"-event-container",EVENT:this.PREFIX+"-event",LABEL:this.PREFIX+"-event-label",START:"start",END:"end"}}}]),_createClass(r,[{key:"componentDidRender",value:function(){this.event=this.container.find("#"+this.uniqueID),this.listeners(),this.reposition()}},{key:"render",value:function(){this.container.append(this.html()),this.componentDidRender()}},{key:"html",value:function(){return"<button class='"+this.CLASSNAMES().EVENT+"' id='"+this.uniqueID+"' title='"+this.title()+"'><span class='"+this.CLASSNAMES().LABEL+"'>"+this.data.title+"</span></button>"}},{key:"title",value:function(){return this.data.title+" ("+this.data.startDate+" - "+this.data.endDate+")"}},{key:"listeners",value:function(){"function"==typeof this.options.onClick&&(this.event.off("click",this.handle_on_click.bind(this)),this.event.on("click",this.handle_on_click.bind(this)))}},{key:"handle_on_click",value:function(t){this.options.onClick(this.data)}},{key:"reposition",value:function(){this.set_start_end();var t=new Date(this.data.startDate),e=(new Date(this.data.endDate),this.start.offset().left-this.container.offset().left);t.getTime()==parseInt(this.start.attr("data-date"))&&(e+=15),this.event.css({marginLeft:e+"px"}),this.resize()}},{key:"resize",value:function(){var t=new Date(this.data.startDate),e=new Date(this.data.endDate),n=this.start.offset().left,i=this.end.offset().left+this.end.outerWidth();t.getTime()==parseInt(this.start.attr("data-date"))&&(n+=15,this.event.hasClass(this.CLASSNAMES().START)||this.event.addClass(this.CLASSNAMES().START)),e.getTime()==parseInt(this.end.attr("data-date"))&&(i-=15,this.event.hasClass(this.CLASSNAMES().END)||this.event.addClass(this.CLASSNAMES().END));var a=i-n;this.event.css({width:a+"px"})}},{key:"set_start_end",value:function(){for(var t=new Date(this.data.startDate),e=new Date(this.data.endDate),n=this.week.find(this.cellSelector),i=null,a=null,s=0;s<n.length;s++){var r=n.eq(s),o=parseInt(r.attr("data-date"));if(null==i&&(i=o>=t.getTime()&&o<=e.getTime()||o==t.getTime()?r:null),null==a&&(n.length-1!=s&&o!=e.getTime()||(a=r)),null!=i&&null!=a)break}this.start=i,this.end=a}},{key:"destroy",value:function(){this.event.remove(),this.event=null}}]),r}();